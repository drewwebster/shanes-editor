!function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s=7)}([function(e,t,o){"use strict";o.d(t,"a",function(){return i});class i{capFirst(e){return(e||"").charAt(0).toUpperCase()+(e||"").slice(1)}getRandomInt(e,t){return Math.floor(Math.random()*(t-e))+e}generateName(){var e=["abandoned","able","absolute","adorable","adventurous","academic","acceptable","acclaimed","accomplished","accurate","aching","acidic","acrobatic","active","actual","adept","admirable","admired","adolescent","adorable","adored","advanced","afraid","affectionate","aged","aggravating","aggressive","agile","agitated","agonizing","agreeable","ajar","alarmed","alarming","alert","alienated","alive","all","altruistic","amazing","ambitious","ample","amused","amusing","anchored","ancient","angelic","angry","anguished","animated","annual","another","antique","anxious","any","apprehensive","appropriate","apt","arctic","arid","aromatic","artistic","ashamed","assured","astonishing","athletic","attached","attentive","attractive","austere","authentic","authorized","automatic","avaricious","average","aware","awesome","awful","awkward","babyish","bad","back","baggy","bare","barren","basic","beautiful","belated","beloved","beneficial","better","best","bewitched","big","big-hearted","biodegradable","bite-sized","bitter","black","black-and-white","bland","blank","blaring","bleak","blind","blissful","blond","blue","blushing","bogus","boiling","bold","bony","boring","bossy","both","bouncy","bountiful","bowed","brave","breakable","brief","bright","brilliant","brisk","broken","bronze","brown","bruised","bubbly","bulky","bumpy","buoyant","burdensome","burly","bustling","busy","buttery","buzzing","calculating","calm","candid","canine","capital","carefree","careful","careless","caring","cautious","cavernous","celebrated","charming","cheap","cheerful","cheery","chief","chilly","chubby","circular","classic","clean","clear","clear-cut","clever","close","closed","cloudy","clueless","clumsy","cluttered","coarse","cold","colorful","colorless","colossal","comfortable","common","compassionate","competent","complete","complex","complicated","composed","concerned","concrete","confused","conscious","considerate","constant","content","conventional","cooked","cool","cooperative","coordinated","corny","corrupt","costly","courageous","courteous","crafty","crazy","creamy","creative","creepy","criminal","crisp","critical","crooked","crowded","cruel","crushing","cuddly","cultivated","cultured","cumbersome","curly","curvy","cute","cylindrical","damaged","damp","dangerous","dapper","daring","darling","dark","dazzling","dead","deadly","deafening","dear","dearest","decent","decimal","decisive","deep","defenseless","defensive","defiant","deficient","definite","definitive","delayed","delectable","delicious","delightful","delirious","demanding","dense","dental","dependable","dependent","descriptive","deserted","detailed","determined","devoted","different","difficult","digital","diligent","dim","dimpled","dimwitted","direct","disastrous","discrete","disfigured","disgusting","disloyal","dismal","distant","downright","dreary","dirty","disguised","dishonest","dismal","distant","distinct","distorted","dizzy","dopey","doting","double","downright","drab","drafty","dramatic","dreary","droopy","dry","dual","dull","dutiful","each","eager","earnest","early","easy","easy-going","ecstatic","edible","educated","elaborate","elastic","elated","elderly","electric","elegant","elementary","elliptical","embarrassed","embellished","eminent","emotional","empty","enchanted","enchanting","energetic","enlightened","enormous","enraged","entire","envious","equal","equatorial","essential","esteemed","ethical","euphoric","even","evergreen","everlasting","every","evil","exalted","excellent","exemplary","exhausted","excitable","excited","exciting","exotic","expensive","experienced","expert","extraneous","extroverted","extra-large","extra-small","fabulous","failing","faint","fair","faithful","fake","false","familiar","famous","fancy","fantastic","far","faraway","far-flung","far-off","fast","fat","fatal","fatherly","favorable","favorite","fearful","fearless","feisty","feline","female","feminine","few","fickle","filthy","fine","finished","firm","first","firsthand","fitting","fixed","flaky","flamboyant","flashy","flat","flawed","flawless","flickering","flimsy","flippant","flowery","fluffy","fluid","flustered","focused","fond","foolhardy","foolish","forceful","forked","formal","forsaken","forthright","fortunate","fragrant","frail","frank","frayed","free","French","fresh","frequent","friendly","frightened","frightening","frigid","frilly","frizzy","frivolous","front","frosty","frozen","frugal","fruitful","full","fumbling","functional","funny","fussy","fuzzy","gargantuan","gaseous","general","generous","gentle","genuine","giant","giddy","gigantic","gifted","giving","glamorous","glaring","glass","gleaming","gleeful","glistening","glittering","gloomy","glorious","glossy","glum","golden","good","good-natured","gorgeous","graceful","gracious","grand","grandiose","granular","grateful","grave","gray","great","greedy","green","gregarious","grim","grimy","gripping","grizzled","gross","grotesque","grouchy","grounded","growing","growling","grown","grubby","gruesome","grumpy","guilty","gullible","gummy","hairy","half","handmade","handsome","handy","happy","happy-go-lucky","hard","hard-to-find","harmful","harmless","harmonious","harsh","hasty","hateful","haunting","healthy","heartfelt","hearty","heavenly","heavy","hefty","helpful","helpless","hidden","hideous","high","high-level","hilarious","hoarse","hollow","homely","honest","honorable","honored","hopeful","horrible","hospitable","hot","huge","humble","humiliating","humming","humongous","hungry","hurtful","husky","icky","icy","ideal","idealistic","identical","idle","idiotic","idolized","ignorant","ill","illegal","ill-fated","ill-informed","illiterate","illustrious","imaginary","imaginative","immaculate","immaterial","immediate","immense","impassioned","impeccable","impartial","imperfect","imperturbable","impish","impolite","important","impossible","impractical","impressionable","impressive","improbable","impure","inborn","incomparable","incompatible","incomplete","inconsequential","incredible","indelible","inexperienced","indolent","infamous","infantile","infatuated","inferior","infinite","informal","innocent","insecure","insidious","insignificant","insistent","instructive","insubstantial","intelligent","intent","intentional","interesting","internal","international","intrepid","ironclad","irresponsible","irritating","itchy","jaded","jagged","jam-packed","jaunty","jealous","jittery","joint","jolly","jovial","joyful","joyous","jubilant","judicious","juicy","jumbo","junior","jumpy","juvenile","kaleidoscopic","keen","key","kind","kindhearted","kindly","klutzy","knobby","knotty","knowledgeable","knowing","known","kooky","kosher","lame","lanky","large","last","lasting","late","lavish","lawful","lazy","leading","lean","leafy","left","legal","legitimate","light","lighthearted","likable","likely","limited","limp","limping","linear","lined","liquid","little","live","lively","livid","loathsome","lone","lonely","long","long-term","loose","lopsided","lost","loud","lovable","lovely","loving","low","loyal","lucky","lumbering","luminous","lumpy","lustrous","luxurious","mad","made-up","magnificent","majestic","major","male","mammoth","married","marvelous","masculine","massive","mature","meager","mealy","mean","measly","meaty","medical","mediocre","medium","meek","mellow","melodic","memorable","menacing","merry","messy","metallic","mild","milky","mindless","miniature","minor","minty","miserable","miserly","misguided","misty","mixed","modern","modest","moist","monstrous","monthly","monumental","moral","mortified","motherly","motionless","mountainous","muddy","muffled","multicolored","mundane","murky","mushy","musty","muted","mysterious","naive","narrow","nasty","natural","naughty","nautical","near","neat","necessary","needy","negative","neglected","negligible","neighboring","nervous","new","next","nice","nifty","nimble","nippy","nocturnal","noisy","nonstop","normal","notable","noted","noteworthy","novel","noxious","numb","nutritious","nutty","obedient","obese","oblong","oily","oblong","obvious","occasional","odd","oddball","offbeat","offensive","official","old","old-fashioned","only","open","optimal","optimistic","opulent","orange","orderly","organic","ornate","ornery","ordinary","original","other","our","outlying","outgoing","outlandish","outrageous","outstanding","oval","overcooked","overdue","overjoyed","overlooked","palatable","pale","paltry","parallel","parched","partial","passionate","past","pastel","peaceful","peppery","perfect","perfumed","periodic","perky","personal","pertinent","pesky","pessimistic","petty","phony","physical","piercing","pink","pitiful","plain","plaintive","plastic","playful","pleasant","pleased","pleasing","plump","plush","polished","polite","political","pointed","pointless","poised","poor","popular","portly","posh","positive","possible","potable","powerful","powerless","practical","precious","present","prestigious","pretty","precious","previous","pricey","prickly","primary","prime","pristine","private","prize","probable","productive","profitable","profuse","proper","proud","prudent","punctual","pungent","puny","pure","purple","pushy","putrid","puzzled","puzzling","quaint","qualified","quarrelsome","quarterly","queasy","querulous","questionable","quick","quick-witted","quiet","quintessential","quirky","quixotic","quizzical","radiant","ragged","rapid","rare","rash","raw","recent","reckless","rectangular","ready","real","realistic","reasonable","red","reflecting","regal","regular","reliable","relieved","remarkable","remorseful","remote","repentant","required","respectful","responsible","repulsive","revolving","rewarding","rich","rigid","right","ringed","ripe","roasted","robust","rosy","rotating","rotten","rough","round","rowdy","royal","rubbery","rundown","ruddy","rude","runny","rural","rusty","sad","safe","salty","same","sandy","sane","sarcastic","sardonic","satisfied","scaly","scarce","scared","scary","scented","scholarly","scientific","scornful","scratchy","scrawny","second","secondary","second-hand","secret","self-assured","self-reliant","selfish","sentimental","separate","serene","serious","serpentine","several","severe","shabby","shadowy","shady","shallow","shameful","shameless","sharp","shimmering","shiny","shocked","shocking","shoddy","short","short-term","showy","shrill","shy","sick","silent","silky","silly","silver","similar","simple","simplistic","sinful","single","sizzling","skeletal","skinny","sleepy","slight","slim","slimy","slippery","slow","slushy","small","smart","smoggy","smooth","smug","snappy","snarling","sneaky","sniveling","snoopy","sociable","soft","soggy","solid","somber","some","spherical","sophisticated","sore","sorrowful","soulful","soupy","sour","Spanish","sparkling","sparse","specific","spectacular","speedy","spicy","spiffy","spirited","spiteful","splendid","spotless","spotted","spry","square","squeaky","squiggly","stable","staid","stained","stale","standard","starchy","stark","starry","steep","sticky","stiff","stimulating","stingy","stormy","straight","strange","steel","strict","strident","striking","striped","strong","studious","stunning","stupendous","stupid","sturdy","stylish","subdued","submissive","substantial","subtle","suburban","sudden","sugary","sunny","super","superb","superficial","superior","supportive","sure-footed","surprised","suspicious","svelte","sweaty","sweet","sweltering","swift","sympathetic","tall","talkative","tame","tan","tangible","tart","tasty","tattered","taut","tedious","teeming","tempting","tender","tense","tepid","terrible","terrific","testy","thankful","that","these","thick","thin","third","thirsty","this","thorough","thorny","those","thoughtful","threadbare","thrifty","thunderous","tidy","tight","timely","tinted","tiny","tired","torn","total","tough","traumatic","treasured","tremendous","tragic","trained","tremendous","triangular","tricky","trifling","trim","trivial","troubled","true","trusting","trustworthy","trusty","truthful","tubby","turbulent","twin","ugly","ultimate","unacceptable","unaware","uncomfortable","uncommon","unconscious","understated","unequaled","uneven","unfinished","unfit","unfolded","unfortunate","unhappy","unhealthy","uniform","unimportant","unique","united","unkempt","unknown","unlawful","unlined","unlucky","unnatural","unpleasant","unrealistic","unripe","unruly","unselfish","unsightly","unsteady","unsung","untidy","untimely","untried","untrue","unused","unusual","unwelcome","unwieldy","unwilling","unwitting","unwritten","upbeat","upright","upset","urban","usable","used","useful","useless","utilized","utter","vacant","vague","vain","valid","valuable","vapid","variable","vast","velvety","venerated","vengeful","verifiable","vibrant","vicious","victorious","vigilant","vigorous","villainous","violet","violent","virtual","virtuous","visible","vital","vivacious","vivid","voluminous","wan","warlike","warm","warmhearted","warped","wary","wasteful","watchful","waterlogged","watery","wavy","wealthy","weak","weary","webbed","wee","weekly","weepy","weighty","weird","welcome","well-documented","well-groomed","well-informed","well-lit","well-made","well-off","well-to-do","well-worn","wet","which","whimsical","whirlwind","whispered","white","whole","whopping","wicked","wide","wide-eyed","wiggly","wild","willing","wilted","winding","windy","winged","wiry","wise","witty","wobbly","woeful","wonderful","wooden","woozy","wordy","worldly","worn","worried","worrisome","worse","worst","worthless","worthwhile","worthy","wrathful","wretched","writhing","wrong","wry","yawning","yearly","yellow","yellowish","young","youthful","yummy","zany","zealous","zesty","zigzag","rocky"];return this.capFirst(e[this.getRandomInt(0,e.length+1)])}}},function(e,t,o){"use strict";class i{constructor(e){this.scene_graph=e,this.store={_cannon:{bodies:[],meshes:[]},_peers:{}}}findByUUID(e,t,o){var i={},n=this;return"string"==typeof e&&(e=[e]),(o||this.scene_graph.container).traverse(function(o){o.userData.plusspace&&e.indexOf(o.userData.plusspace.object.uuid)>-1&&(i[o.userData.plusspace.object.uuid]=t?JSON.stringify(n.scene_graph.serialiseScene(o)):o)}),i}setupNetworking(){var e=this;this.scene_graph.context.socket.on("new-user",function(t){e.store._peers[t.userId]=t}),this.scene_graph.context.socket.on("all-users",function(t){var o=t.filter(function(t){return t.userId===e.scene_graph.context.user.userId});o.length&&t.filter(function(t){return t.userId!==e.scene_graph.context.user.userId&&t.connect_time<o[0].connect_time}).forEach(function(t){e.store._peers[t.userId]=t,e.store._peers[t.userId].peer||e.addPeer({userId:t.userId},!0,e.network_callback||function(){})})}),this.scene_graph.context.socket.emit("all-users"),this.scene_graph.context.socket.on("remove-user",function(t){delete e.store._peers[t.userId]}),this.scene_graph.context.socket.on("signal",function(t){e.store._peers[t.userId]&&e.store._peers[t.userId].peer||(e.store._peers[t.userId]={userId:t.userId},e.addPeer({userId:t.userId},!1,e.network_callback||function(){})),e.store._peers[t.userId].peer.signal(t.signal)})}addPeer(e,t,o){var i=this;if(e.userId!==this.scene_graph.context.user.userId){Object.keys(this.store._peers).filter(function(e){return!!i.store._peers[e]}).length>11&&console.warn("Maximum stream count of 12 achieved. Ignoring further requests.");var n=new SimplePeer({initiator:t,channelName:this.scene_graph.context.space.sid,reconnectTimer:500});n.on("signal",function(t){i.scene_graph.context.socket.emit("signal",{signal:t,userId:e.userId})}),i.store._peers[e.userId].peer=n,n.on("connect",function(){console.log("Shane's Editor: Network peer connection opened - ",e.userId),n.on("close",function(){delete i.store._peers[e.userId]}),n.on("data",function(t){try{o({userId:e.userId,data:new TextDecoder("utf-8").decode(t)})}catch(e){}})}),n.on("error",function(t){console.warn(t),delete i.store._peers[e.userId]})}}getPeers(){return Object.keys(this.store._peers)}sendToAll(e){var t=this;Object.keys(this.store._peers).forEach(function(o){t.store._peers[o].peer&&t.store._peers[o].peer.connected&&t.store._peers[o].peer.connected&&t.store._peers[o].peer.send(e)})}sendTo(e,t){this.store._peers[e]&&this.store._peers[e].peer&&this.store._peers[e].peer.send(t)}onMessage(e){this.network_callback=e}getSceneGraph(){return this.scene_graph}loadJS(e){var t=this;if(this.external_scripts=this.external_scripts||[],this.external_scripts.map(function(e){return e.url+e.loaded}).indexOf(e+"true")>-1)return Promise.resolve();var o=this.external_scripts.map(function(e){return e.url}).indexOf(e);if(o>-1)return new Promise(function(e){t.external_scripts[o].callbacks.push(e)});var i={url:e,loaded:!1,callbacks:[]};return this.external_scripts.push(i),new Promise(function(t){var o=document.createElement("script");o.src=e,o.onload=function(){i.loaded=!0,t(),i.callbacks.forEach(function(e){e()})},o.onreadystatechange=function(){i.loaded=!0,t(),i.callbacks.forEach(function(e){e()})},document.body.appendChild(o)})}portalUser(e){var t=this,o="string"==typeof e;return t.scene_graph.context.user&&!this.not_to_move?(this.not_to_move=!0,this.plusspaceTargetEntity||(this.plusspaceTargetEntity=new THREE.Object3D,this.scene_graph.context.simulation.scene.add(this.plusspaceTargetEntity),this.plusspaceTargetTrigger=new THREE.Object3D,this.scene_graph.context.simulation.scene.add(this.plusspaceTargetTrigger),this.plusspacePortal=new altspaceutil.behaviors.NativeComponent("n-portal",o?{targetSpace:e}:{},o?{}:{targetEntity:this.plusspaceTargetEntity}),this.plusspaceAttach=new altspaceutil.behaviors.NativeComponent("n-skeleton-parent",{index:0,part:"eye",side:"left",userId:t.scene_graph.context.user.userId}),this.plusspaceTargetTrigger.addBehaviors(this.plusspacePortal,this.plusspaceAttach),this.plusspaceTargetTrigger.scale.set(1e-5,1,1e-5),this.plusspaceTargetTrigger.position.set(0,-1e3,0)),o||(this.plusspaceTargetEntity.position.set(e.x,e.y,e.z),this.plusspacePortal.data.targetPosition=this.plusspaceTargetEntity.position),this.plusspaceTargetTrigger.position.set(0,0,0),new Promise(function(e){setTimeout(function(){t.plusspaceTargetTrigger.position.set(0,-1e3,0),t.not_to_move=!1,e()},2e3)})):Promise.reject("not_to_move")}getCannonWorld(){return this.cannonWorld||(this.cannonWorld=new CANNON.World),this.cannonWorld}getPortalSocket(){return this.scene_graph.context.portal_socket}bakeLight(e){return this.scene_graph.lighting.bakeVertexLighting(e,this.scene_graph.light)}resetCannonWorld(e){if(this.cannonWorld)for(var t=this.store._cannon.meshes.length,o=0;o<t;o++){this.cannonWorld.remove(this.store._cannon.bodies.pop());var i=this.store._cannon.meshes.pop();e.remove(i)}}addCannonMesh(e,t,o,i){this.cannonBodyAxisSwap(e);var n=new THREE.Object3D;o.add(n);for(var a=new THREE.MeshBasicMaterial(i?{visible:!1}:{side:THREE.DoubleSide,color:t,map:(new THREE.TextureLoader).load("/images/display_texture.png")}),r=0;r<e.shapes.length;r++){var s,l=e.shapes[r];switch(l.type){case CANNON.Shape.types.SPHERE:var c=new THREE.SphereGeometry(l.radius,16,16);s=new THREE.Mesh(c,a);break;case CANNON.Shape.types.PARTICLE:s=new THREE.Mesh(this.particleGeo,particleMaterial);var h=this.settings;s.scale.set(h.particleSize,h.particleSize,h.particleSize);break;case CANNON.Shape.types.PLANE:var u=new THREE.PlaneGeometry(10,10,4,4);s=new THREE.Object3D;var d=new THREE.Object3D,m=new THREE.Mesh(u,a);m.scale.set(100,100,100),d.add(m),s.add(d);break;case CANNON.Shape.types.BOX:var p=new THREE.BoxGeometry(2*l.halfExtents.x,2*l.halfExtents.y,2*l.halfExtents.z);s=new THREE.Mesh(p,a);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:for(var b=new THREE.Geometry,g=0;g<l.vertices.length;g++){var j=l.vertices[g];b.vertices.push(new THREE.Vector3(j.x,j.y,j.z))}for(g=0;g<l.faces.length;g++)for(var _=l.faces[g],y=_[0],f=1;f<_.length-1;f++){var w=_[f],T=_[f+1];b.faces.push(new THREE.Face3(y,w,T))}b.computeBoundingSphere(),b.computeVertexNormals(),b.computeFaceNormals(),s=new THREE.Mesh(b,a);break;case CANNON.Shape.types.HEIGHTFIELD:u=new THREE.Geometry;for(var x=new CANNON.Vec3,v=new CANNON.Vec3,k=new CANNON.Vec3,E=0;E<l.data.length-1;E++)for(var S=0;S<l.data[E].length-1;S++)for(var M=0;M<2;M++){l.getConvexTrianglePillar(E,S,0===M),x.copy(l.pillarConvex.vertices[0]),v.copy(l.pillarConvex.vertices[1]),k.copy(l.pillarConvex.vertices[2]),x.vadd(l.pillarOffset,x),v.vadd(l.pillarOffset,v),k.vadd(l.pillarOffset,k),u.vertices.push(new THREE.Vector3(x.x,x.y,x.z),new THREE.Vector3(v.x,v.y,v.z),new THREE.Vector3(k.x,k.y,k.z));g=u.vertices.length-3;u.faces.push(new THREE.Face3(g,g+1,g+2))}u.computeBoundingSphere(),u.computeFaceNormals(),u.computeVertexNormals(),s=new THREE.Mesh(u,a);break;case CANNON.Shape.types.TRIMESH:for(u=new THREE.Geometry,x=new CANNON.Vec3,v=new CANNON.Vec3,k=new CANNON.Vec3,g=0;g<l.indices.length/3;g++){l.getTriangleVertices(g,x,v,k),u.vertices.push(new THREE.Vector3(x.x,x.y,x.z),new THREE.Vector3(v.x,v.y,v.z),new THREE.Vector3(k.x,k.y,k.z));f=u.vertices.length-3;u.faces.push(new THREE.Face3(f,f+1,f+2))}u.computeBoundingSphere(),u.computeFaceNormals(),u.computeVertexNormals(),s=new THREE.Mesh(u,a);break;default:throw"Visual type not recognized: "+l.type}var P=e.shapeOffsets[r],C=e.shapeOrientations[r];s.position.set(P.x,P.y,P.z),s.quaternion.set(C.x,C.y,C.z,C.w),n.add(s)}return this.store._cannon.bodies.push(e),this.store._cannon.meshes.push(n),n}cannonBodyAxisSwap(e){}updateCannonPhysics(){if(this.cannonWorld){var e=Date.now()/1e3;if(!this.lastCallTime)return this.cannonWorld.step(1/90),void(this.lastCallTime=e);var t=e-this.lastCallTime;this.cannonWorld.step(1/90,t,3),this.lastCallTime=e}for(var o=this.store._cannon.bodies.length,i=0;i<o;i++){var n=this.store._cannon.bodies[i],a=this.store._cannon.meshes[i];a.position.copy(n.position),n.quaternion&&a.quaternion.copy(n.quaternion)}}}class n{constructor(e){this.sceneGraph=e}makeMaterial(e){let t={};return new Promise(o=>{if(Object.keys(e).filter(function(e){return-1===["type","map","texture","lightTexture","normalMap","lightMap","envMap","alphaMap","aoMap","emissiveMap","metalnessMap","normalMap","roughnessMap","bumpMap"].indexOf(e)}).forEach(function(o){t[o]=e[o]}),e.map&&"string"==typeof e.map)try{let i=(new THREE.TextureLoader).load(e.map,()=>{o(new THREE[e.type](t))});i.offset.set(e.texture.offset.x||0,e.texture.offset.y||0),i.repeat.set(e.texture.repeat.x||1,e.texture.repeat.y||1),e.texture.wrapping&&(i.wrapS=e.texture.wrapping.s,i.wrapT=e.texture.wrapping.t,i.minFilter=e.texture.filters.min,i.magFilter=e.texture.filters.mag),t.map=i}catch(e){console.log(e)}else o(new THREE[e.type](t))})}phongSettingsWithDefaults(e,t){["MeshPhongMaterial","MeshToonMaterial"].indexOf(t.type)>-1&&(e.color=t.color||"#ffffff",e.bumpMap=t.bumpMap||"",e.bumpScale=t.bumpScale||1,e.displacementMap=t.displacementMap||"",e.displacementScale=t.displacementScale||1,e.displacementBias=t.displacementBias||0,e.emissive=t.emissive||"#000",e.emissiveMap=t.emissiveMap||"",e.emissiveIntensity=t.emissiveIntensity||1,e.morphNormals=t.morphNormals||!1,e.morphTargets=t.morphTargets||!1,e.normalMap=t.normalMap||"",e.normalScale=t.normalScale||new THREE.Vector2(1,1),e.shininess=t.shininess||30,e.specular=t.specular||"#111111",e.specularMap=t.specularMap||"",e.reflectivity=t.reflectivity||.5,e.refractionRatio=t.reflectivity||.98,e.skinning=t.skinning||!1)}standardSettingsWithDefaults(e,t){["MeshStandardMaterial","MeshPhysicalMaterial"].indexOf(t.type)>-1&&(e.color=t.color||"#ffffff",e.bumpMap=t.bumpMap||"",e.bumpScale=t.bumpScale||1,e.displacementMap=t.displacementMap||"",e.displacementScale=t.displacementScale||1,e.displacementBias=t.displacementBias||0,e.emissive=t.emissive||"#000000",e.emissiveMap=t.emissiveMap||"",e.emissiveIntensity=t.emissiveIntensity||1,e.envMapIntensity=t.emissiveIntensity||1,e.metalness=t.metalness||.5,e.metalnessMap=t.metalnessMap||"",e.morphNormals=t.morphNormals||!1,e.morphTargets=t.morphTargets||!1,e.normalMap=t.normalMap||"",e.normalScale=t.normalScale||new THREE.Vector2(1,1),e.roughness=t.roughness||.8,e.roughnessMap=t.roughnessMap||"",e.refractionRatio=t.reflectivity||.98,e.skinning=t.skinning||!1)}wireframeSettingsWithDefaults(e,t){["MeshBasicMaterial","MeshStandardMaterial","MeshLambertMaterial","MeshPhongMaterial","MeshPhysicalMaterial","MeshToonMaterial"].indexOf(t.type)>-1&&(e.wireframe=t.wireframe||!1,e.wireframeLinecap=t.wireframeLinecap||"round",e.wireframeLinejoin=t.wireframeLinejoin||"round",e.wireframeLinewidth=t.wireframeLinewidth||1)}mapSettingsWithDefaults(e,t){["MeshBasicMaterial","MeshStandardMaterial","MeshLambertMaterial","MeshPhongMaterial","MeshPhysicalMaterial","MeshToonMaterial"].indexOf(t.type)>-1&&(e.map=t.map||"",e.alphaMap=t.alphaMap||"",e.aoMap=t.aoMap||"",e.aoMapIntensity=t.aoMapIntensity||1,e.envMap=t.envMap||"",e.lightMap=t.lightMap||"",e.lightMapIntensity=t.lightMapIntensity||1)}materialSettingsWithDefaults(e){let t={type:e.type||"MeshStandardMaterial",visible:!1!==e.visible||e.visible,transparent:e.transparent||!1,alphaTest:e.alphaTest||.5,opacity:e.opacity||1,side:e.side||THREE.FrontSide,texture:{wrapping:{s:e.texture&&e.texture.wrapping?e.texture.wrapping.s:THREE.RepeatWrapping,t:e.texture&&e.texture.wrapping?e.texture.wrapping.t:THREE.RepeatWrapping},repeat:{x:e.texture&&e.texture.repeat?e.texture.repeat.x:1,y:e.texture&&e.texture.repeat?e.texture.repeat.y:1},offset:{x:e.texture&&e.texture.offset?e.texture.offset.x:0,y:e.texture&&e.texture.offset?e.texture.offset.y:0},filters:{mag:e.texture&&e.texture.filters?e.texture.filters.mag:THREE.LinearFilter,min:e.texture&&e.texture.filters?e.texture.filters.min:THREE.LinearMipMapLinearFilter}},lightTexture:{wrapping:{s:e.lightTexture&&e.lightTexture.wrapping?e.lightTexture.wrapping.s:THREE.RepeatWrapping,t:e.lightTexture&&e.lightTexture.wrapping?e.lightTexture.wrapping.t:THREE.RepeatWrapping},repeat:{x:e.lightTexture&&e.lightTexture.repeat?e.lightTexture.repeat.x:0,y:e.lightTexture&&e.lightTexture.repeat?e.lightTexture.repeat.y:0},offset:{x:e.lightTexture&&e.lightTexture.offset?e.lightTexture.offset.x:0,y:e.lightTexture&&e.lightTexture.offset?e.lightTexture.offset.y:0},filters:{mag:e.lightTexture&&e.lightTexture.filters?e.lightTexture.filters.mag:THREE.LinearFilter,min:e.lightTexture&&e.lightTexture.filters?e.lightTexture.filters.min:THREE.LinearMipMapLinearFilter}}};switch(e.type){case"MeshBasicMaterial":this.mapSettingsWithDefaults(t,e),t.color=e.color||"#ffffff",t.reflectivity=e.reflectivity||.5,t.refractionRatio=e.reflectivity||.98,t.skinning=e.skinning||!1,t.lights=e.lights||!1,t.fog=e.fog||!1,t.specularMap=e.specularMap||"",this.wireframeSettingsWithDefaults(t,e);break;case"MeshStandardMaterial":this.mapSettingsWithDefaults(t,e),this.standardSettingsWithDefaults(t,e),this.wireframeSettingsWithDefaults(t,e);break;case"MeshLambertMaterial":this.mapSettingsWithDefaults(t,e),t.color=e.color||"#ffffff",t.emissive=e.emissive||"#000",t.emissiveMap=e.emissiveMap||"",t.emissiveIntensity=e.emissiveIntensity||1,t.morphNormals=e.morphNormals||!1,t.morphTargets=e.morphTargets||!1,t.reflectivity=e.reflectivity||.5,t.refractionRatio=e.reflectivity||.98,t.skinning=e.skinning||!1,t.specularMap=e.specularMap||"",this.wireframeSettingsWithDefaults(t,e);break;case"MeshPhongMaterial":this.mapSettingsWithDefaults(t,e),this.phongSettingsWithDefaults(t,e),this.wireframeSettingsWithDefaults(t,e);break;case"MeshDepthMaterial":t.alphaMap=e.alphaMap||"",t.fog=e.fog||!1,t.lights=e.lights||!1,t.displacementMap=e.displacementMap||"",t.displacementScale=e.displacementScale||1,t.displacementBias=e.displacementBias||0,t.depthPacking=e.depthPacking||THREE.BasicDepthPacking,t.map=e.map||"",t.skinning=e.skinning||!1,t.wireframe=e.wireframe||!1,t.wireframeLinewidth=e.wireframeLinewidth||1;break;case"MeshPhysicalMaterial":this.mapSettingsWithDefaults(t,e),this.standardSettingsWithDefaults(t,e),t.clearCoat=e.clearCoat||0,t.clearCoatRoughness=e.clearCoatRoughness||0,t.reflectivity=e.reflectivity||.5,this.wireframeSettingsWithDefaults(t,e);break;case"MeshToonMaterial":this.mapSettingsWithDefaults(t,e),t.gradientMap=e.gradientMap||"",this.phongSettingsWithDefaults(t,e),this.wireframeSettingsWithDefaults(t,e)}return t}}class a{klein(e,t){let o,i,n;return t*=Math.PI,e*=2*Math.PI,(t*=2)<Math.PI?(o=3*Math.cos(t)*(1+Math.sin(t))+2*(1-Math.cos(t)/2)*Math.cos(t)*Math.cos(e),n=-8*Math.sin(t)-2*(1-Math.cos(t)/2)*Math.sin(t)*Math.cos(e)):(o=3*Math.cos(t)*(1+Math.sin(t))+2*(1-Math.cos(t)/2)*Math.cos(e+Math.PI),n=-8*Math.sin(t)),i=-2*(1-Math.cos(t)/2)*Math.sin(e),new THREE.Vector3(o,i,n)}invertedKlein(e,t){return this.klein(t,e)}mobius(e,t){let o,i,n;e-=.5,t=2*Math.PI*t;return o=Math.cos(t)*(2+e*Math.cos(t/2)),i=Math.sin(t)*(2+e*Math.cos(t/2)),n=e*Math.sin(t/2),new THREE.Vector3(o,i,n)}mobius3d(e,t){e*=Math.PI,t*=2*Math.PI;let o,i,n,a=(e*=2)/2;return o=.125*Math.cos(t)*Math.cos(a)-.65*Math.sin(t)*Math.sin(a),n=.125*Math.cos(t)*Math.sin(a)+.65*Math.sin(t)*Math.cos(a),i=(2.25+o)*Math.sin(e),o=(2.25+o)*Math.cos(e),new THREE.Vector3(o,i,n)}invertedMobius3d(e,t){return this.mobius3d(t,e)}apple(e,t){e=2*e*Math.PI,t=2*t*Math.PI-Math.PI;let o=Math.cos(e)*(4+3.8*Math.cos(t)),i=Math.sin(e)*(4+3.8*Math.cos(t)),n=(Math.cos(t)+Math.sin(t)-1)*(1+Math.sin(t))*Math.log(1-Math.PI*t/10)+7.5*Math.sin(t);return new THREE.Vector3(o,i,n)}invertedApple(e,t){return this.apple(t,e)}snail(e,t){e=2*e*Math.PI,t=4*t*Math.PI-2*Math.PI;let o=e*Math.cos(t)*Math.sin(e),i=e*Math.cos(e)*Math.cos(t),n=-e*Math.sin(t);return new THREE.Vector3(o,i,n)}invertedSnail(e,t){return this.snail(t,e)}spiral(e,t){e=2*e*-Math.PI;let o=.1*(1-(t=2*t*-Math.PI)/2*Math.PI)*Math.cos(4*t)*(1-Math.cos(e))+.3*Math.cos(4*t),i=.1*(1-t/2*Math.PI)*Math.sin(4*t)*(1-Math.cos(e))+.3*Math.sin(4*t),n=1*t/2*Math.PI+.1*(1-t/2*Math.PI)*Math.sin(e);return new THREE.Vector3(o,i,n)}invertedSpiral(e,t){return this.spiral(t,e)}fermet(e,t){e=16*e-8,abs_u=e<0?-e:e,t*=1;let o=e<0?-1:1,i=o*Math.sqrt(abs_u)*Math.cos(abs_u),n=.8*t,a=o*Math.sqrt(abs_u)*Math.sin(abs_u);return new THREE.Vector3(i,a,n)}helicoid(e,t){e=6*e*-Math.PI;let o=2*(t=2*t*Math.PI-Math.PI)*Math.cos(e),i=2*t*Math.sin(e),n=e;return new THREE.Vector3(o,i,n)}horn(e,t){t=2*t*Math.PI;let o=(2+e*Math.cos(t))*Math.cos(2*Math.PI*e)+2*e,i=(2+e*Math.cos(t))*Math.sin(2*Math.PI*e),n=e*Math.sin(t);return new THREE.Vector3(o,i,n)}invertedHorn(e,t){return this.horn(t,e)}pillow(e,t){e=2*e*Math.PI-Math.PI,t=2*t*Math.PI-Math.PI;let o=Math.cos(e),i=Math.cos(t),n=Math.sin(e)*Math.sin(t);return new THREE.Vector3(o,i,n)}invertedPillow(e,t){return this.pillow(t,e)}spring(e,t){e=6*e*-Math.PI,t=2*t*Math.PI-Math.PI;let o=(1-.3*Math.cos(t))*Math.cos(e),i=(1-.3*Math.cos(t))*Math.sin(e),n=.3*(Math.sin(t)+1.2*e/Math.PI);return new THREE.Vector3(o,i,n)}invertedSpring(e,t){return this.spring(t,e)}scherk(e,t){let o=t=t*Math.PI-Math.PI/2,i=e=e*Math.PI-Math.PI/2,n=Math.log(Math.cos(.9*e)/Math.cos(.9*t))/.9;return new THREE.Vector3(o,i,n)}catenoid(e,t){e=2*e*Math.PI,t=2*t*Math.PI-Math.PI;let o=2*Math.cosh(t/2)*Math.sin(e),i=2*Math.cosh(t/2)*Math.cos(e),n=t;return new THREE.Vector3(o,i,n)}natica(e,t){e=21*e-20,t*=2*Math.PI;let o=Math.exp(.18*e),i=Math.sin(t),n=Math.cos(t),a=Math.sin(1*e),r=o*(1.25+2.6*n)*Math.cos(1*e),s=1*o*(1.25+2.6*n)*a,l=o*(2.4*i-2.8);return new THREE.Vector3(r,s,l)}invertedNatica(e,t){return this.natica(t,e)}}class r{constructor(e){this.sceneGraph=e,this.parametricGeometries=new a}makeGeometry(e){let t=this.geometrySettingsWithDefaults(e),o=[null];for(let e in t)t.hasOwnProperty(e)&&o.push(t[e]);return new(Function.prototype.bind.apply(THREE[e.type],o))}makeParametric(e){let t=this.parametricSettingsWithDefaults(e),o={document:document,scene:this.sceneGraph.context.sceneEl.object3D,root:this.sceneGraph.container,helper:this.sceneGraph.behaviourHelper},i=t.user_options||{},n=[null,{AppleGeometry:this.parametricGeometries.apple,AppleInvertedGeometry:this.parametricGeometries.invertedApple.bind(this.parametricGeometries),FermatGeometry:this.parametricGeometries.fermet,KleinGeometry:this.parametricGeometries.klein,KleinInvertedGeometry:this.parametricGeometries.invertedKlein.bind(this.parametricGeometries),HelicoidGeometry:this.parametricGeometries.helicoid,PillowGeometry:this.parametricGeometries.pillow,PillowInvertedGeometry:this.parametricGeometries.invertedPillow.bind(this.parametricGeometries),ScherkGeometry:this.parametricGeometries.scherk,MobiusGeometry:this.parametricGeometries.mobius,Mobius3DGeometry:this.parametricGeometries.mobius3d,Mobius3DInvertedGeometry:this.parametricGeometries.invertedMobius3d.bind(this.parametricGeometries),NaticaStellataGeometry:this.parametricGeometries.natica,NaticaInvertedGeometry:this.parametricGeometries.invertedNatica.bind(this.parametricGeometries),HornGeometry:this.parametricGeometries.horn,HornInvertedGeometry:this.parametricGeometries.invertedHorn.bind(this.parametricGeometries),SpringGeometry:this.parametricGeometries.spring,SpringInvertedGeometry:this.parametricGeometries.invertedSpring.bind(this.parametricGeometries),CatenoidGeometry:this.parametricGeometries.catenoid,SnailGeometry:this.parametricGeometries.snail,SnailInvertedGeometry:this.parametricGeometries.invertedSnail.bind(this.parametricGeometries),SpiralGeometry:this.parametricGeometries.spiral,SpiralInvertedGeometry:this.parametricGeometries.invertedSpiral.bind(this.parametricGeometries),CustomGeometry:function(e,n){let a=new THREE.Vector3(1,1,1);try{(a=new Function("u","v","globals","user_config",t.method||"return new THREE.Vector3(0,0,0);")(e,n,o,i))&&a.constructor===THREE.Vector3||(console.warn("Custom Geometry Error: ",t.name,"Definition does not return a THREE.Vector3"),a=new THREE.Vector3(1,1,1))}catch(e){console.warn("Custom Geometry Error: ",t.name,e),a=new THREE.Vector3(1,1,1)}return a}}[e.sub_type]],a=["name","description","method","image","user_config","user_options","parametric_id"];for(let e in t)t.hasOwnProperty(e)&&-1===a.indexOf(e)&&n.push(t[e]);return new(Function.prototype.bind.apply(THREE.ParametricBufferGeometry,n))}parametricSettingsWithDefaults(e){switch(e.sub_type){case"AppleGeometry":case"AppleInvertedGeometry":case"FermatGeometry":case"SpringGeometry":case"SpringInvertedGeometry":case"NaticaStellataGeometry":case"NaticaStellataInvertedGeometry":case"HelicoidGeometry":case"SpiralGeometry":case"SpiralInvertedGeometry":case"PillowGeometry":case"PillowInvertedGeometry":case"CatenoidGeometry":case"ScherkGeometry":case"KleinGeometry":case"KleinInvertedGeometry":case"MobiusGeometry":case"Mobius3DGeometry":case"Mobius3DInvertedGeometry":case"SnailGeometry":case"SnailInvertedGeometry":case"HornGeometry":case"HornInvertedGeometry":return{slices:e.slices||24,stacks:e.stacks||24};case"CustomGeometry":return{name:e.name||"",description:e.description||"",image:e.image||"images/parametric.png",method:e.method||"",user_config:e.user_config||"",user_options:e.user_options||{},parametric_id:e.parametric_id||0,slices:e.slices||24,stacks:e.stacks||24}}}geometrySettingsWithDefaults(e){switch(e.type){case"BoxGeometry":case"BoxBufferGeometry":return{width:e.width||1,height:e.height||1,depth:e.depth||1,widthSegments:e.widthSegments||1,heightSegments:e.heightSegments||1,depthSegments:e.depthSegments||1};case"CircleGeometry":case"CircleBufferGeometry":return{radius:e.radius||1,segments:e.segments||24,thetaStart:e.thetaStart||0,thetaLength:e.thetaLength||2*Math.PI};case"ConeGeometry":case"ConeBufferGeometry":return{radius:e.radius||1,height:e.height||1,radialSegments:e.radialSegments||24,heightSegments:e.heightSegments||1,openEnded:!1,thetaStart:e.thetaStart||0,thetaLength:e.thetaLength||2*Math.PI};case"CylinderGeometry":case"CylinderBufferGeometry":return{radiusTop:e.radiusTop||1,radiusBottom:e.radiusBottom||1,height:e.height||1,radialSegments:e.radialSegments||24,heightSegments:e.heightSegments||1,openEnded:!1,thetaStart:e.thetaStart||0,thetaLength:e.thetaLength||2*Math.PI};case"DodecahedronGeometry":case"DodecahedronBufferGeometry":return{radius:e.radius||1,detail:e.detail||1};case"IcosahedronGeometry":case"IcosahedronBufferGeometry":return{radius:e.radius||1,detail:e.detail||1};case"OctahedronGeometry":case"OctahedronBufferGeometry":return{radius:e.radius||1,detail:e.detail||1};case"PlaneGeometry":case"PlaneBufferGeometry":return{width:e.width||1,height:e.height||1,widthSegments:e.widthSegments||1,heightSegments:e.heightSegments||1};case"RingGeometry":case"RingBufferGeometry":return{innerRadius:e.innerRadius||.5,outerRadius:e.outerRadius||1,thetaSegments:e.thetaSegments||24,phiSegments:e.phiSegments||8,thetaStart:e.thetaStart||0,thetaLength:e.thetaLength||2*Math.PI};case"SphereGeometry":case"SphereBufferGeometry":return{radius:e.radius||1,widthSegments:e.widthSegments||16,heightSegments:e.heightSegments||16,phiStart:e.phiStart||0,phiLength:e.phiLength||2*Math.PI,thetaStart:e.thetaStart||0,thetaLength:e.thetaLength||Math.PI};case"TetrahedronGeometry":case"TetrahedronBufferGeometry":return{radius:e.radius||1,detail:e.detail||0};case"TorusGeometry":case"TorusBufferGeometry":return{radius:e.radius||1,tube:e.tube||.4,radialSegments:e.radialSegments||8,tubularSegments:e.tubularSegments||16,arc:e.arc||2*Math.PI};case"TorusKnotGeometry":case"TorusKnotBufferGeometry":return{radius:e.radius||1,tube:e.tube||.4,tubularSegments:e.tubularSegments||64,radialSegments:e.radialSegments||8,p:e.p||2,q:e.q||3};default:return{}}}}class s{constructor(e){this.sceneGraph=e,this.materialFactory=new n(e),this.geometryFactory=new r(e)}changeGeometry(e){let t="Primitive"===this.sceneGraph.context.currentObject.settings.type,o=this.geometryFactory[t?"geometrySettingsWithDefaults":"parametricSettingsWithDefaults"](t?{type:e}:{sub_type:e});this.sceneGraph.context.currentObject.settings.geometry=o,t?this.sceneGraph.context.currentObject.settings.geometry.type=e:this.sceneGraph.context.currentObject.settings.geometry.sub_type=e,this.resetGeometry()}resetGeometry(){let e=this.sceneGraph.context.currentObject.settings;this.sceneGraph.context.currentObject.object3D.geometry="Primitive"===e.type?this.geometryFactory.makeGeometry(e.geometry):this.geometryFactory.makeParametric(e.geometry),"Primitive"!==e.type&&this.scaleAndCenterGeometry(this.sceneGraph.context.currentObject.object3D.geometry),this.addStats(this.sceneGraph.context.currentObject.object3D,this.sceneGraph.context.currentObject)}changeMaterial(e){console.log(e);let t=this.sceneGraph.context.currentObject.settings;t.material.type=e,this.sceneGraph.context.currentObject.settings.material=this.materialFactory.materialSettingsWithDefaults(t.material),console.log(this.sceneGraph.context.currentObject.settings.material),this.materialFactory.makeMaterial(this.sceneGraph.context.currentObject.settings.material).then(e=>{this.sceneGraph.context.currentObject.object3D.material=e})}generateUserData(e){console.log(e);let t=this.defaultUserData(e.type,e.sub_type||"",e.geo_settings||{},e.mat_settings||{},e.tra_settings||{},e.name);return e.url&&(t.url=e.url),e.mtl_url&&(t.mtl_url=e.mtl_url,t.mtl_path=e.mtl_path),t.state.added=!0,t}defaultUserData(e,t,o,i,n,a,r){return(o=o||{}).type=t,o.sub_type=o.sub_type||"",{name:a||this.sceneGraph.context.namer.generateName(),uuid:r||THREE.Math.generateUUID(),type:e||"Object3D",transform:{position:{x:n&&n.position&&n.position.x||0,y:n&&n.position&&n.position.y||0,z:n&&n.position&&n.position.z||0},rotation:{x:n&&n.rotation&&n.rotation.x||0,y:n&&n.rotation&&n.rotation.y||0,z:n&&n.rotation&&n.rotation.z||0},scale:{x:n&&n.scale&&n.scale.x||1,y:n&&n.scale&&n.scale.y||1,z:n&&n.scale&&n.scale.z||1}},behaviours:[],hide_on_mobile:!1,hide_on_desktop:!1,geometry:o||{},material:this.materialFactory.materialSettingsWithDefaults(i||{}),state:{added:!1,updated:!1,transform_update:!1,removed:!1}}}getTotals(e){let t={points:0,pixels:0},o=[];return e.traverse(e=>{e.geometry&&e.geometry.attributes?t.points+=e.geometry.attributes.position.count:e.geometry&&e.geometry.faces&&(t.points+=3*e.geometry.faces.length),e.material&&e.material.map&&e.material.map.image&&-1===o.indexOf(e.material.map.image.currentSrc)&&(o.push(e.material.map.image.currentSrc),t.pixels+=e.material.map.image.width*e.material.map.image.height)}),t}addStats(e,t){t.settings.stats||(t.settings.stats=this.getTotals(e))}transform(e,t){e.userData.sceneObject=t,e&&(e.rotation.set(t.settings.transform.rotation.x,t.settings.transform.rotation.y,t.settings.transform.rotation.z),e.position.set(t.settings.transform.position.x,t.settings.transform.position.y,t.settings.transform.position.z),e.scale.set(t.settings.transform.scale.x,t.settings.transform.scale.y,t.settings.transform.scale.z))}resolveObject(e,t,o,i){this.transform(e,o),this.scaleAndCenterObject(t),e.add(t),this.addStats(e,o),setTimeout(()=>i(e),50)}make(e){let t=e.settings;return new Promise(o=>{let i,n,a,r;switch(t.type){case"Primitive":n=this.geometryFactory.makeGeometry(t.geometry),this.materialFactory.makeMaterial(t.material).then(t=>{i=new THREE.Mesh(n,t),this.transform(i,e),this.addStats(i,e),o(i)});break;case"Parametric":n=this.geometryFactory.makeParametric(t.geometry),this.scaleAndCenterGeometry(n),this.materialFactory.makeMaterial(t.material).then(t=>{i=new THREE.Mesh(n,t),this.transform(i,e),this.addStats(i,e),o(i)});break;case"Object3D":(i=new THREE.Object3D).name="Group",this.transform(i,e),i.userData.sceneObject.stats={points:0,pixels:0},o(i);break;case"Poly":case"Custom":switch((i=new THREE.Object3D).name=t.type,t.geometry.type){case"GLTF2":a=Promise.resolve(t.url),"Poly"===t.type&&(a=new Promise(function(e){(new THREE.FileLoader).load("poly-proxy/"+encodeURIComponent(t.url),function(t){e(t)})})),a.then(t=>{let n=new THREE.GLTFLoader;n.setCrossOrigin(!0),n.load(t,t=>this.resolveObject(i,t.scene,e,o))});break;case"DAE":let n=t.url;(r=new THREE.ColladaLoader).setCrossOrigin(!0),r.load(n,t=>this.resolveObject(i,t.scene,e,o));break;case"GLTF":(r=new THREE.LegacyGLTFLoader).setCrossOrigin(!0),r.load(t.url,t=>this.resolveObject(i,t.scene,e,o));break;case"OBJ":a=Promise.resolve({obj:t.url,mtl:t.mtl_url,mtl_path:t.mtl_path}),"Poly"===t.type&&(a=Promise.all([new Promise(function(e){(new THREE.FileLoader).load("poly-proxy/"+encodeURIComponent(t.url),function(t){e(t)})}),new Promise(function(e){(new THREE.FileLoader).load("poly-proxy/"+encodeURIComponent(t.mtl_url),function(t){e(t)})})]).then(function(e){let o=t.url.replace(t.mtl_path,"");return{obj:e[0],mtl:e[1],mtl_path:e[0].slice(0,e[0].indexOf(o))}})),(r=new THREE.MTLLoader).setCrossOrigin(!0),a.then(t=>{r.setTexturePath(t.mtl_path),r.load(t.mtl,n=>{n.preload(),(r=new THREE.OBJLoader).setMaterials(n),r.load(t.obj,t=>this.resolveObject(i,t,e,o))})})}}})}getScaledVector(e){return e.x>=e.y&&e.x>=e.z?new THREE.Vector3(1,e.y/e.x,e.z/e.x):e.y>e.x&&e.y>e.z?new THREE.Vector3(e.x/e.y,1,e.z/e.y):e.z>e.x&&e.z>e.y?new THREE.Vector3(e.x/e.z,e.y/e.z,1):new THREE.Vector3(1,1,1)}scaleAndCenterGeometry(e){e.computeBoundingBox();let t=e.boundingBox.getSize(),o=this.getScaledVector(t),i=t.divide(o);e.scale(1/i.x,1/i.y,1/i.z),e.center()}scaleAndCenterObject(e){let t=(new THREE.Box3).setFromObject(e),o=t.getSize(),i=this.getScaledVector(o),n=o.divide(i);e.scale.set(1/n.x,1/n.y,1/n.z);let a=t.getCenter().clone().negate();e.position.copy(new THREE.Vector3(a.x/n.x,a.y/n.y,a.z/n.z))}}class l{constructor(e){this.sceneGraph=e}deSerialiseScene(e,t,o){if(e&&e.settings){t=t||this.sceneGraph.container,o=o||[],e.settings.uuid||(e.settings.uuid=THREE.Math.generateUUID()),e.object3D=t,t.userData.sceneObject=e;for(let i=0;i<e.children.length;i++)o.push(Promise.resolve().then(()=>{let n=e.children[i];if(n)return this.sceneGraph.objectFactory.make(n).then(i=>{if(i)return t.add(i),n.parent=e,this.deSerialiseScene(n,i,o),{object:i,child:n}})}));return o}}serialiseScene(e){if(e=e||this.sceneGraph.container,!this.isObject(e))return;let t={settings:{},children:[]};return e.userData=e.userData||{},e.userData.plusspace=e.userData.plusspace||this.sceneGraph.objectFactory.defaultUserData(),t.settings=e.userData.plusspace,"Custom"!==t.settings.type&&"Poly"!==t.settings.type&&e.children&&e.children.length&&e.children.forEach(e=>{t.children.push(this.serialiseScene(e))}),t}isObject(e){return e.userData&&e.userData.plusspace&&e.userData.plusspace.object&&e.userData.plusspace.geometry&&e.userData.plusspace.material}}class c{constructor(e){this.scene_graph=e}resetBehaviours(e){let t=this;e.removeAllBehaviors();let o=[];e.userData.plusspace.altspace.behaviours.forEach(function(i,n){let a=i.settings||{};a.trigger=a.trigger||"auto-trigger",a.trigger&&["toggle-trigger","mod-toggle-trigger","no-mod-toggle-trigger","click-trigger","mod-click-trigger","no-mod-click-trigger"].indexOf(a.trigger)>-1&&e.userData.altspace&&(e.userData.altspace.collider=e.userData.altspace.collider||{},e.userData.altspace.collider.enabled=!0);let r=t.getBehaviour(i,e),s=function(){(e=t.resetObject(e)).addBehavior(r),a.sync&&t.context.socket.emit("behaviour-sync",{index:n,uuid:e.userData.plusspace.object.uuid})},l=function(){e.userData.has_been_clicked?((e=t.resetObject(e)).userData.has_been_clicked=!1,t.context.socket.emit("behaviour-sync",{index:n,uuid:e.userData.plusspace.object.uuid,is_toggle:!0,enabled:!1})):(e.userData.has_been_clicked=!0,e.addBehavior(r),console.log(r),a.sync&&t.context.socket.emit("behaviour-sync",{index:n,uuid:e.userData.plusspace.object.uuid,is_toggle:!0,enabled:!0}))};if(r)switch(a.trigger){case"auto-trigger":o.push(r);break;case"mod-auto-trigger":t.context.user&&t.context.user.isModerator&&e.addBehavior(r);break;case"no-mod-auto-trigger":t.context.user&&!t.context.user.isModerator&&e.addBehavior(r);break;case"click-trigger":e.addEventListener("cursordown",function(){s()});break;case"mod-click-trigger":e.addEventListener("cursordown",function(){t.context.user&&t.context.user.isModerator&&s()});break;case"no-mod-click-trigger":e.addEventListener("cursordown",function(){t.context.user&&!t.context.user.isModerator&&s()});break;case"toggle-trigger":e.addEventListener("cursordown",function(){l()});break;case"mod-toggle-trigger":e.addEventListener("cursordown",function(){t.context.user&&t.context.user.isModerator&&l()});break;case"no-mod-toggle-trigger":e.addEventListener("cursordown",function(){t.context.user&&!t.context.user.isModerator&&l()});break;case"enter-trigger":e.addEventListener("triggerenter",function(){s()});break;case"exit-trigger":e.addEventListener("triggerexit",function(){s()});break;case"mod-enter-trigger":e.addEventListener("triggerenter",function(){t.context.user&&t.context.user.isModerator&&s()});break;case"no-mod-enter-trigger":e.addEventListener("triggerenter",function(){t.context.user&&!t.context.user.isModerator&&s()});break;case"mod-exit-trigger":e.addEventListener("triggerexit",function(){t.context.user&&t.context.user.isModerator&&s()});break;case"no-mod-exit-trigger":e.addEventListener("triggerexit",function(){t.context.user&&!t.context.user.isModerator&&s()})}}),o.length&&e.addBehaviors.apply(e,o)}}class h{constructor(e){this.context=e}getVersion(){if(!this.context.currentScene)return;return this.context.currentScene.version||"1.0"}migrate(){switch(this.getVersion()){case"1.0":console.log("migration started"),this.migrateV2(),console.log("migration done")}}migrateV2(e){if(e=e||this.context.currentScene,this.context.currentScene===e&&(e.version="2.0"),e.settings.object){let t=e.settings.object.url,o=e.settings.object.mtl_url,i=e.settings.object.mtl_path;e.settings={name:e.settings.object.name,uuid:e.settings.object.uuid,type:e.settings.object.type,transform:e.settings.object.transform,behaviours:e.settings.altspace.behaviours,hide_on_mobile:e.settings.object.hide_on_mobile||!1,hide_on_desktop:e.settings.object.show_only_on_mobile||!1,geometry:e.settings.geometry,preserve_scale:!1,material:this.context.objectFactory.materialFactory.materialSettingsWithDefaults({type:"MeshBasicMaterial",visible:e.settings.material.visible,color:e.settings.material.color,transparent:e.settings.material.transparent,opacity:e.settings.material.opacity,map:e.settings.material.map,side:e.settings.material.side,fog:!1,lights:!1,texture:{wrapping:{s:e.settings.wrapping?e.settings.wrapping.s:THREE.RepeatWrapping,t:e.settings.wrapping?e.settings.wrapping.t:THREE.RepeatWrapping},repeat:{x:e.settings.material.repeatX?e.settings.material.repeatX:1,y:e.settings.material.repeatY?e.settings.material.repeatY:1},offset:{x:e.settings.material.offsetX?e.settings.material.offsetX:0,y:e.settings.material.offsetY?e.settings.material.offsetY:0},filters:{mag:e.settings.filters?e.settings.filters.mag:THREE.LinearFilter,min:e.settings.filters?e.settings.filters.min:THREE.LinearMipMapLinearFilter}},lightTexture:{wrapping:{s:THREE.RepeatWrapping,t:THREE.RepeatWrapping},repeat:{x:1,y:1},offset:{x:0,y:0},filters:{mag:THREE.LinearFilter,min:THREE.LinearMipMapLinearFilter}}}),state:{added:!1,updated:!1,transform_updated:!1,removed:!1}},t&&(e.settings.url=t),o&&(e.settings.mtl_url=o),i&&(e.settings.mtl_path=i)}e.children=e.children.filter(e=>e);for(let t=0;t<e.children.length;t++)e.children[t]&&this.migrateV2(e.children[t])}}o.d(t,"a",function(){return u});class u{constructor(e){this.context=e,this.migrations=new h(this),this.behaviourHelper=new i(this),this.objectFactory=new s(this),this.serialiser=new l(this),this.behaviourFactory=new c(this),this.currentScene={settings:this.objectFactory.defaultUserData(),children:[]},this.resetContainer(),this.containerComponentName="scene-graph-container",this.setupAframeContainer(),console.log("Scene Editor Version 0.1.0")}async load(e){return fetch(window.location.protocol+"//"+window.location.host+"/scene/"+e.short_code+".json").then(e=>e.json()).then(t=>(this.clearScene(),this.hasScene=!0,this.sceneLoaded=!1,this.currentScene=t||this.currentScene,this.migrations.migrate(),this.currentScene.metadata=e,console.log("Scene Downloaded."),Promise.resolve()))}canOpen(){return this.hasScene&&!this.sceneLoaded}dispatchLoadEvents(e){let t=0,o=e.length;for(let i=0;i<o;i++){e[i].then(()=>{t++,this.context.sceneEl.emit("scene-loading",t/o)})}}open(){if(console.log("Loading Scene..."),this.context.sceneEl.emit("scene-load-start"),!this.currentScene||this.sceneLoaded)return;this.sceneLoaded=!0;let e=this.serialiser.deSerialiseScene(this.currentScene);return this.dispatchLoadEvents(e),Promise.all(e)}setupAframeContainer(){let e=this;AFRAME.registerComponent(this.containerComponentName,{init(){this.setObject3d(e.container)},setObject3d(e){this.el.setObject3D("mesh",e)}}),this.entityContainer=document.createElement("a-entity"),this.entityContainer.setAttribute("scene-graph-container",""),this.entityContainer.setAttribute("position","0 -1.6 0"),document.querySelector("a-scene").appendChild(this.entityContainer)}totals(e,t,o,i){let n=e.settings.hide_on_mobile,a=e.settings.hide_on_desktop;e.settings.stats&&(a||o?a=!0:(t.desktop.points+=e.settings.stats.points,t.desktop.pixels+=e.settings.stats.pixels),n||i?n=!0:(t.mobile.points+=e.settings.stats.points,t.mobile.pixels+=e.settings.stats.pixels));for(let o=0;o<e.children.length;o++)this.totals(e.children[o],t,a,n)}resetContainer(){this.container=new THREE.Object3D,this.currentScene.settings=this.objectFactory.defaultUserData(),this.currentScene.children.length=0,this.container.userData.sceneObject=this.currentScene}findByUUID(e,t,o){let i={},n=this;return"string"==typeof e&&(e=[e]),(o||this.container).traverse(function(o){o.userData.sceneObject&&e.indexOf(o.userData.sceneObject.uuid)>-1&&(i[o.userData.sceneObject.uuid]=t?JSON.stringify(n.scene_graph.serialiseScene(o)):o)}),1===e.length?i[e[0]]:i}remove(e,t){let o=e.children[t];if(o&&o.settings.uuid){let i=this.findByUUID(o.settings.uuid);i&&(i.parent.remove(i),this.clearObject(i)),e.children.splice(t,1)}}async add(e,t){if(this.context.cameraDummy){this.context.cameraDummy.object3D.position.set(0,0,-3),this.context.cameraDummy.object3D.updateMatrixWorld(),e.object3D.updateMatrixWorld();let o=this.context.cameraDummy.object3D.localToWorld(new THREE.Vector3(0,0,0));t.tra_settings={position:e.object3D.worldToLocal(o)}}let o=this.objectFactory.generateUserData(t);if(e.settings.uuid){let t={settings:o,children:[]};return this.objectFactory.make(t).then(o=>(t.object3D=o,t.parent=e,e.object3D.add(o),e.children.push(t),t))}}getPointInBetweenByPerc(e,t,o){let i=t.clone().sub(e).normalize().multiplyScalar(e.distanceTo(t)*(o||.5));return e.clone().add(i)}clearObject(e){e.traverse(e=>{if(e.material&&e.material.map&&e.material.map.dispose&&(e.material.map.dispose(),e.material.dispose&&e.material.dispose()),e.material&&e.material.length)for(let t=0;t<e.material.length;t++)e.material[t].map&&e.material[t].map.dispose&&e.material[t].map.dispose();e.geometry&&e.geometry.dispose(),e.dispose&&e.dispose()})}clearScene(){this.hasScene=!1,this.clearObject(this.container),this.resetContainer(),this.entityContainer.components[this.containerComponentName].setObject3d(this.container)}}},function(e,t){var o=AFRAME.utils.bind,i=AFRAME.utils.device.PolyfillControls,n=Math.PI/2,a=AFRAME.utils.device.checkHasPositionalTracking;AFRAME.registerComponent("right-look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},hmdEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},touchEnabled:{default:!0}},init:function(){this.previousHMDPosition=new THREE.Vector3,this.hmdQuaternion=new THREE.Quaternion,this.hmdEuler=new THREE.Euler,this.position=new THREE.Vector3,this.savedRotation=new THREE.Vector3,this.savedPosition=new THREE.Vector3,this.polyfillObject=new THREE.Object3D,this.polyfillControls=new i(this.polyfillObject),this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.savedPose={position:new THREE.Vector3,rotation:new THREE.Euler},this.el.sceneEl.is("vr-mode")&&this.onEnterVR(),document.addEventListener("contextmenu",e=>{e.preventDefault()},!1)},update:function(e){var t=this.data;t.enabled!==e.enabled&&this.updateGrabCursor(t.enabled),!e||t.hmdEnabled||e.hmdEnabled||(this.pitchObject.rotation.set(0,0,0),this.yawObject.rotation.set(0,0,0)),e&&!t.pointerLockEnabled!==e.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&document.exitPointerLock())},tick:function(e){this.data.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.removeEventListeners()},bindMethods:function(){this.onMouseDown=o(this.onMouseDown,this),this.onMouseMove=o(this.onMouseMove,this),this.onMouseUp=o(this.onMouseUp,this),this.onTouchStart=o(this.onTouchStart,this),this.onTouchMove=o(this.onTouchMove,this),this.onTouchEnd=o(this.onTouchEnd,this),this.onEnterVR=o(this.onEnterVR,this),this.onExitVR=o(this.onExitVR,this),this.onPointerLockChange=o(this.onPointerLockChange,this),this.onPointerLockError=o(this.onPointerLockError,this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new THREE.Object3D,this.yawObject=new THREE.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var e=this.el.sceneEl,t=e.canvas;t?(t.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),t.addEventListener("touchstart",this.onTouchStart),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd),e.addEventListener("enter-vr",this.onEnterVR),e.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))):e.addEventListener("render-target-loaded",o(this.addEventListeners,this))},removeEventListeners:function(){var e=this.el.sceneEl,t=e&&e.canvas;t&&(t.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("enter-vr",this.onEnterVR),e.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var e=this.el,t=this.hmdEuler,o=this.pitchObject,i=this.yawObject,n=this.el.sceneEl;n.is("vr-mode")&&n.checkHeadsetConnected()||(this.polyfillControls.update(),t.setFromQuaternion(this.polyfillObject.quaternion,"YXZ"),e.object3D.rotation.x=t.x+o.rotation.x,e.object3D.rotation.y=t.y+i.rotation.y)},onMouseMove:function(e){var t,o,i,a=this.pitchObject,r=this.previousMouseEvent,s=this.yawObject;this.data.enabled&&(this.mouseDown||this.pointerLocked)&&(this.pointerLocked?(o=e.movementX||e.mozMovementX||0,i=e.movementY||e.mozMovementY||0):(o=e.screenX-r.screenX,i=e.screenY-r.screenY),this.previousMouseEvent=e,t=this.data.reverseMouseDrag?1:-1,s.rotation.y+=.002*o*t,a.rotation.x+=.002*i*t,a.rotation.x=Math.max(-n,Math.min(n,a.rotation.x)))},onMouseDown:function(e){if(this.data.enabled&&2===e.button){var t=this.el.sceneEl,o=t&&t.canvas;this.mouseDown=!0,this.previousMouseEvent=e,document.body.classList.add("a-grabbing"),this.data.pointerLockEnabled&&!this.pointerLocked&&(o.requestPointerLock?o.requestPointerLock():o.mozRequestPointerLock&&o.mozRequestPointerLock())}},onMouseUp:function(){this.mouseDown=!1,this.el.emit("stopped"),document.body.classList.remove("a-grabbing")},onTouchStart:function(e){1===e.touches.length&&this.data.touchEnabled&&(this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(e){var t,o=this.el.sceneEl.canvas,i=this.yawObject;this.touchStarted&&this.data.touchEnabled&&(t=2*Math.PI*(e.touches[0].pageX-this.touchStart.x)/o.clientWidth,i.rotation.y-=.5*t,this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){this.saveCameraPose()},onExitVR:function(){this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0)},onPointerLockChange:function(){this.pointerLocked=!(!document.pointerLockElement&&!document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},updateGrabCursor:function(e){var t=this.el.sceneEl;function o(){t.canvas.classList.add("a-grab-cursor")}function i(){t.canvas.classList.remove("a-grab-cursor")}t.canvas?e?o():i():e?t.addEventListener("render-target-loaded",o):t.addEventListener("render-target-loaded",i)},saveCameraPose:function(){var e=this.el,t=void 0!==this.hasPositionalTracking?this.hasPositionalTracking:a();!this.hasSavedPose&&t&&(this.savedPose.position.copy(e.object3D.position),this.savedPose.rotation.copy(e.object3D.rotation),this.hasSavedPose=!0)},restoreCameraPose:function(){var e=this.el,t=this.savedPose,o=void 0!==this.hasPositionalTracking?this.hasPositionalTracking:a();this.hasSavedPose&&o&&(e.object3D.position.copy(t.position),e.object3D.rotation.copy(t.rotation),this.hasSavedPose=!1)}})},function(e,t,o){e.exports=function(){return new Worker(o.p+"a5d424edf9f8a6d549c2.worker.js")}},function(e,t){e.exports=AFRAME.registerComponent("gizmo",{schema:{raycasterEl:{type:"selector"},cameraEl:{type:"selector"},displayEl:{type:"selector"},mode:{default:"position"}},init(){this.setupElements(),this.setMode(),this.currentTransform={position:new THREE.Vector3,rotation:new THREE.Vector3,scale:new THREE.Vector3}},updateSchema(){this.top_box&&!this.isAnimating&&this.toggle(!0).then(()=>this.setMode()).then(()=>this.toggle())},setObject(e,t){if(!e)return new TWEEN.Tween(this.el.getAttribute("scale")).to(new THREE.Vector3(1e-5,1e-5,1e-5),250).easing(TWEEN.Easing.Exponential.Out).start();new TWEEN.Tween(this.el.getAttribute("scale")).to(new THREE.Vector3(1,1,1),250).easing(TWEEN.Easing.Exponential.Out).start(),this.boundingBox=t;let o=t.getSize(),i=e.parent.localToWorld(e.position.clone());this.el.setAttribute("position",i),this.el.setAttribute("position",{x:i.x-(.12+o.x/2),y:i.y,z:i.z-(.12+o.z/2)});let n=this.el.sceneEl.context.currentObject;this.currentTransform.position=(new THREE.Vector3).copy(n.settings.transform.position),this.currentTransform.rotation=(new THREE.Vector3).copy(n.settings.transform.rotation),this.currentTransform.scale=(new THREE.Vector3).copy(n.settings.transform.scale)},toggle(e){return new Promise(t=>{this.isAnimating=!0;let o=e?1e-5:1;new TWEEN.Tween(this.el.getAttribute("scale")).to(new THREE.Vector3(o,o,o),250).onComplete(()=>{this.isAnimating=!1,t()}).easing(TWEEN.Easing.Exponential.Out).start()})},play(){this.mousedown=(e=>this.onMouseDown(e)),this.mousemove=(e=>this.onMouseMove(e)),this.mouseup=(e=>this.onMouseUp(e)),this.addListeners(this.top_box),this.addListeners(this.x_box),this.addListeners(this.y_box),this.addListeners(this.z_box)},pause(){this.removeListeners(this.top_box),this.removeListeners(this.x_box),this.removeListeners(this.y_box),this.removeListeners(this.z_box)},addListeners(e){e.addEventListener("mousedown",this.mousedown),e.addEventListener("mouseup",this.mouseup)},removeListeners(e){e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("mouseup",this.mouseup)},getDraggingSpine(){let e,t,o;return this.dragging===this.x_box?(e=this.x_spine,t="x",o=new THREE.Vector3(-.5,0,0)):this.dragging===this.y_box?(e=this.y_spine,t="y",o=new THREE.Vector3(0,-.5,0)):this.dragging===this.z_box?(e=this.z_spine,t="z",o=new THREE.Vector3(0,0,-.5)):this.dragging===this.top_box&&(e=this.top_spine,t="top",o=new THREE.Vector3(0,-.7,0)),{spine:e,axis:t,offset:o}},onMouseUp(e){if(this.dragging){this.dragging.setAttribute("position",this.defaultPosition);let e=this.getDraggingSpine();e.spine.object3D.scale.z="top"===e.axis?.71:.51,this.setMode(),this.backing_element.setAttribute("scale","0.001 0.001 0.001"),this.backing_element.className="",this.backing_element.removeEventListener("ui-mousemove",this.mousemove),this.el.sceneEl.context.currentObject.settings.transform=this.deepCopy(this.currentTransform),this.el.sceneEl.emit("transform-update"),this.data.displayEl.components["display-box"].setObject(this.el.sceneEl.context.currentObject.object3D),delete this.dragging}},setSpinePosition(e,t){let o=new THREE.Vector3(0,0,0),i=this.getDraggingSpine();(t=t||i.spine).setAttribute("position",this.getPointInBetweenByPerc(e,o));let n=e.distanceTo(o);return i.scale=n,i.angle=Math.atan2(e.y,e.x),t.object3D.scale.z=n,t.object3D.lookAt(e),i},setBoxRotation(e,t){if("rotation"===this.data.mode)switch(t){case"x":this[t+"_box"].object3D.rotation.z=Math.atan2(e.y,e.x);break;case"y":this[t+"_box"].object3D.rotation.y=Math.atan2(e.x,e.z);break;case"z":this[t+"_box"].object3D.rotation.x=-Math.atan2(e.y,e.z)}},onMouseMove(e){if(this.dragging){let t=this.el.object3D.worldToLocal(e.x?e:e.detail.intersection.point);this.dragging.setAttribute("position",t);let o=this.setSpinePosition(t);this.setBoxRotation(t,o.axis),this.updateObject(t,o)}},updateObject(e,t){let o=this.el.sceneEl.context.currentObject;if("position"===this.data.mode){let i=e.clone().add(this.saveCurrentTransform.position).add(t.offset);switch(t.axis){case"x":this.currentTransform.position.x=i.x;break;case"y":this.currentTransform.position.y=i.y;break;case"z":this.currentTransform.position.z=i.z;break;case"top":this.currentTransform.position.copy(i)}o.object3D.position.copy(this.currentTransform.position)}else if("rotation"===this.data.mode){let i=new THREE.Vector3;switch(t.axis){case"x":i.z=Math.atan2(e.y,e.x)-1;break;case"y":i.y=Math.atan2(e.x,e.z)-1.25*Math.PI;break;case"z":i.x=1-Math.atan2(e.y,e.z)}let n=this.getRotation(i);this.currentTransform.rotation=n.vector,o.object3D.rotation.copy(n.euler)}else if("scale"===this.data.mode){let e=2*(t.scale/(this.dragging===this.top_box?.7:.5)-1),i=new THREE.Vector3(e,e,e).add(this.saveCurrentTransform.scale);switch(t.axis){case"x":this.currentTransform.scale.x=i.x;break;case"y":this.currentTransform.scale.y=i.y;break;case"z":this.currentTransform.scale.z=i.z;break;case"top":this.currentTransform.scale.copy(i)}o.object3D.scale.copy(this.currentTransform.scale)}},matrixFromEuler:function(e){return(new THREE.Matrix4).makeRotationFromEuler(e)},getRotation:function(e){let t=this.matrixFromEuler(new THREE.Euler(this.saveCurrentTransform.rotation.x,this.saveCurrentTransform.rotation.y,this.saveCurrentTransform.rotation.z)),o=(new THREE.Euler).setFromVector3(e),i=t.premultiply(this.matrixFromEuler(o)),n=(new THREE.Euler).setFromRotationMatrix(i);return{euler:n,vector:new THREE.Vector3(n.x,n.y,n.z)}},getPointInBetweenByPerc(e,t,o){let i=t.clone().sub(e).normalize().multiplyScalar(e.distanceTo(t)*(o||.5));return e.clone().add(i)},getPointOnCircle(e,t,o){let i=new THREE.Vector3;switch(t){case"x":i.x=Math.cos(e)*o,i.y=Math.sin(e)*o,i.z=0;break;case"y":i.x=Math.sin(e)*o,i.y=0,i.z=Math.cos(e)*o;break;case"z":i.z=Math.cos(e)*o,i.y=Math.sin(e)*o,i.x=0}return i},onMouseDown(e){-1!==[this.top_box,this.x_box,this.y_box,this.z_box].indexOf(e.target)&&(this.dragging=e.target,this.backing_element.className="intersect",this.backing_element.setAttribute("scale","1000 1000 1000"),this.defaultPosition=e.target.getAttribute("position").clone(),this.backing_element.setAttribute("position",this.defaultPosition),this.backing_element.addEventListener("ui-mousemove",this.mousemove),this.backing_element.object3D.lookAt(this.backing_element.object3D.parent.worldToLocal(this.data.cameraEl.object3D.getWorldPosition())),this.saveCurrentTransform=this.deepCopy(this.el.sceneEl.context.currentObject.settings.transform),this.currentTransform.position.copy(this.saveCurrentTransform.position),this.currentTransform.scale.copy(this.saveCurrentTransform.scale),this.currentTransform.rotation.copy(this.saveCurrentTransform.rotation))},deepCopy:e=>JSON.parse(JSON.stringify(e)),setupElements(){this.backing_element=document.createElement("a-plane"),this.backing_element.setAttribute("scale","0.001 0.001 0.001"),this.backing_element.setAttribute("side","double"),this.backing_element.setAttribute("visible",!1),this.el.appendChild(this.backing_element),this.top_box=this.createElement("0.1 0.1 0.1",!1,!0),this.top_box.setAttribute("position","0 0.7 0"),this.x_box=this.createElement("0.1 0.1 0.1","blue",!0),this.y_box=this.createElement("0.1 0.1 0.1","green",!0),this.z_box=this.createElement("0.1 0.1 0.1","red",!0),this.top_spine=this.createElement("0.005 0.005 0.71","#cfcfcf"),this.top_spine.setAttribute("position","0 0.355 0"),this.x_spine=this.createElement("0.01 0.01 0.509","blue"),this.y_spine=this.createElement("0.01 0.01 0.509","green"),this.z_spine=this.createElement("0.01 0.01 0.509","red"),this.x_rail=this.createRail("0 0 0","blue"),this.y_rail=this.createRail("-90 0 0","green"),this.z_rail=this.createRail("0 90 0","red")},setMode(){this.setImage(this.data.mode),"rotation"===this.data.mode?(this.rot_x_pos=this.getPointOnCircle(1,"x",.475),this.rot_y_pos=this.getPointOnCircle(1.25*Math.PI,"y",.475),this.rot_z_pos=this.getPointOnCircle(1,"z",.475),this.top_box.setAttribute("visible",!1),this.top_spine.setAttribute("visible",!1),this.x_rail.setAttribute("visible",!0),this.y_rail.setAttribute("visible",!0),this.z_rail.setAttribute("visible",!0),this.x_box.object3D.rotation.z=1,this.y_box.object3D.rotation.y=1.25*Math.PI,this.z_box.object3D.rotation.x=-1):(this.x_box.object3D.rotation.z=0,this.y_box.object3D.rotation.y=0,this.z_box.object3D.rotation.x=0,this.top_box.setAttribute("visible",!0),this.top_spine.setAttribute("visible",!0),this.x_rail.setAttribute("visible",!1),this.y_rail.setAttribute("visible",!1),this.z_rail.setAttribute("visible",!1),this.top_spine.setAttribute("rotation","90 0 0"),this.top_spine.setAttribute("position","0 0.355 0")),this.x_box.setAttribute("position","rotation"===this.data.mode?this.rot_x_pos:"0.5 0 0"),this.x_box.setAttribute("position","rotation"===this.data.mode?this.rot_x_pos:"0.5 0 0"),this.y_box.setAttribute("position","rotation"===this.data.mode?this.rot_y_pos:"0 0.5 0"),this.z_box.setAttribute("position","rotation"===this.data.mode?this.rot_z_pos:"0 0 0.5"),setTimeout(()=>{this.setSpinePosition(this.top_box.getAttribute("position"),this.top_spine),this.setSpinePosition(this.x_box.getAttribute("position"),this.x_spine),this.setSpinePosition(this.y_box.getAttribute("position"),this.y_spine),this.setSpinePosition(this.z_box.getAttribute("position"),this.z_spine)})},setImage(e){this.top_box.setAttribute("src","images/gizmos/"+e+"_top.jpg"),this.x_box.setAttribute("src","images/gizmos/"+e+"_top.jpg"),this.y_box.setAttribute("src","images/gizmos/"+e+"_top.jpg"),this.z_box.setAttribute("src","images/gizmos/"+e+"_top.jpg")},createRail(e,t){let o=document.createElement("a-ring");return o.setAttribute("radius-inner",.45),o.setAttribute("radius-outer",.5),o.setAttribute("segments-theta",36),o.setAttribute("theta-length","green"===t?270:360),o.setAttribute("rotation",e),o.setAttribute("side","double"),o.setAttribute("color",t),this.el.appendChild(o),o},createElement(e,t,o){let i=document.createElement("a-box");return i.setAttribute("scale",e),o&&(i.className="intersect"),t&&i.setAttribute("color",t),this.el.appendChild(i),i}})},function(e,t){e.exports=AFRAME.registerComponent("display-box",{schema:{gizmoEl:{type:"selector"}},init(){this.setupElements()},setupElements(){this.display_box=document.createElement("a-box"),this.display_box.setAttribute("src","images/display_texture.png"),this.display_box.setAttribute("side","back"),this.display_box.setAttribute("transparent",!0),this.display_box.setAttribute("shader","flat"),this.display_box.setAttribute("opacity",.1),this.el.appendChild(this.display_box),this.cornerContainer=document.createElement("a-entity"),this.el.appendChild(this.cornerContainer),this.corner_ftl=this.createCorner("FTL"),this.corner_ftr=this.createCorner("FTR"),this.corner_fbl=this.createCorner("FBL"),this.corner_fbr=this.createCorner("FBR"),this.corner_btl=this.createCorner("BTL"),this.corner_btr=this.createCorner("BTR"),this.corner_bbl=this.createCorner("BBL"),this.corner_bbr=this.createCorner("BBR")},hide(){this.setObject()},setObject(e){if(!e)return this.data.gizmoEl.components.gizmo&&this.data.gizmoEl.components.gizmo.setObject(),this.el.sceneEl.context.viewUtils.hideTransformOptions(),new TWEEN.Tween(this.display_box.getAttribute("scale")).to(new THREE.Vector3(1e-5,1e-5,1e-5),250).onComplete(()=>{new TWEEN.Tween(this.el.getAttribute("scale")).to(new THREE.Vector3(1e-5,1e-5,1e-5),250).easing(TWEEN.Easing.Exponential.Out).start()}).easing(TWEEN.Easing.Exponential.Out).start();this.el.sceneEl.context.viewUtils.showTransformOptions(),this.boundingBox=(new THREE.Box3).setFromObject(e),this.boundingBoxSize=this.boundingBox.getSize(),new TWEEN.Tween(this.el.getAttribute("scale")).to(new THREE.Vector3(1,1,1),250).easing(TWEEN.Easing.Exponential.Out).start(),new TWEEN.Tween(this.display_box.getAttribute("scale")).to(new THREE.Vector3(this.boundingBoxSize.x+.1,this.boundingBoxSize.y+.1,this.boundingBoxSize.z+.1),250).easing(TWEEN.Easing.Exponential.Out).start(),new TWEEN.Tween(this.display_box.getAttribute("position")).to(this.boundingBox.getCenter(),250).easing(TWEEN.Easing.Exponential.Out).start(),this.cornerContainer.setAttribute("scale","0.000001 0.000001 0.000001"),new TWEEN.Tween(this.cornerContainer.getAttribute("scale")).to(new THREE.Vector3(1,1,1),250).easing(TWEEN.Easing.Exponential.Out).start(),this.setCornerPositions(),this.data.gizmoEl.components.gizmo&&this.data.gizmoEl.components.gizmo.setObject(e,this.boundingBox)},setCornerPositions(){let e=this.boundingBox.min,t=this.boundingBox.max;this.corner_ftl.setAttribute("position",{x:e.x,y:t.y,z:e.z}),this.corner_ftr.setAttribute("position",{x:t.x,y:t.y,z:e.z}),this.corner_fbl.setAttribute("position",{x:e.x,y:e.y,z:e.z}),this.corner_fbr.setAttribute("position",{x:t.x,y:e.y,z:e.z}),this.corner_btl.setAttribute("position",{x:e.x,y:t.y,z:t.z}),this.corner_btr.setAttribute("position",{x:t.x,y:t.y,z:t.z}),this.corner_bbl.setAttribute("position",{x:e.x,y:e.y,z:t.z}),this.corner_bbr.setAttribute("position",{x:t.x,y:e.y,z:t.z})},createCorner(e){let t=document.createElement("a-box"),o=document.createElement("a-box"),i=document.createElement("a-box");t.setAttribute("scale","0.16 0.009 0.009"),o.setAttribute("scale","0.01 0.16 0.01"),i.setAttribute("scale","0.009 0.009 0.16");switch(e){case"FTL":t.setAttribute("position",.075-.055+" 0.055 -0.055"),o.setAttribute("position","-0.055 "+(.055-.075)+" -0.055"),i.setAttribute("position","-0.055 0.055 "+(.075-.055));break;case"FTR":t.setAttribute("position",.055-.075+" 0.055 -0.055"),o.setAttribute("position","0.055 "+(.055-.075)+" -0.055"),i.setAttribute("position","0.055 0.055 "+(.075-.055));break;case"FBL":t.setAttribute("position",.075-.055+" -0.055 -0.055"),o.setAttribute("position","-0.055 "+(.075-.055)+" -0.055"),i.setAttribute("position","-0.055 -0.055 "+(.075-.055));break;case"FBR":t.setAttribute("position",.055-.075+" -0.055 -0.055"),o.setAttribute("position","0.055 "+(.075-.055)+" -0.055"),i.setAttribute("position","0.055 -0.055 "+(.075-.055));break;case"BTL":t.setAttribute("position",.075-.055+" 0.055 0.055"),o.setAttribute("position","-0.055 "+(.055-.075)+" 0.055"),i.setAttribute("position","-0.055 0.055 "+(.055-.075));break;case"BTR":t.setAttribute("position",.055-.075+" 0.055 0.055"),o.setAttribute("position","0.055 "+(.055-.075)+" 0.055"),i.setAttribute("position","0.055 0.055 "+(.055-.075));break;case"BBL":t.setAttribute("position",.075-.055+" -0.055 0.055"),o.setAttribute("position","-0.055 "+(.075-.055)+" 0.055"),i.setAttribute("position","-0.055 -0.055 "+(.055-.075));break;case"BBR":t.setAttribute("position",.055-.075+" -0.055 0.055"),o.setAttribute("position","0.055 "+(.075-.055)+" 0.055"),i.setAttribute("position","0.055 -0.055 "+(.055-.075))}let n=document.createElement("a-entity");return n.appendChild(t),n.appendChild(o),n.appendChild(i),this.cornerContainer.appendChild(n),n}})},,function(e,t,o){"use strict";o.r(t);var i=o(3),n=o.n(i);class a{constructor(e){this.context=e,this.content_worker=new n.a,this.popup=document.getElementById("popupContent"),this.container=document.getElementById("mainContent"),this.contentContainer=this.container.querySelector(".container"),this.templateContainer=document.getElementById("templateContainer"),this.templateCache={},this.resolveCache={},this.content_worker.onmessage=(e=>this.workerMessage(e))}workerMessage(e){this.resolveCache[e.data.reqId]&&(this.resolveCache[e.data.reqId](e.data.data),delete this.resolveCache[e.data.reqId])}reloadContent(){this.container.updateContent()}reloadPopup(){this.popup.updateContent()}async addTemplateItem(e,t,o){return new Promise(i=>{document.querySelector(e).insertAdjacentHTML("beforeend",t),o?document.querySelector(e).lastChild.addEventListener("loaded",i):i()})}async compileTemplates(e,t){if(this.templateCache[e])return this.templateCache[e].then(e=>{let o=THREE.Math.generateUUID();return this.content_worker.postMessage({type:"compile",elements:t.map(t=>({text:e,data:t})),reqId:o}),new Promise(e=>{this.resolveCache[o]=e})})}async loadScreen(e,t,o){await this.loadTemplates(t).then(()=>fetch("/html/views/"+e+".html")).then(e=>e.text()).then(e=>this.container.setContent(e,o))}async loadTemplates(e){return Promise.all((e||[]).map(e=>{let t=Promise.resolve();return this.templateCache[e]||(t=fetch("/html/templates/"+e+".html").then(t=>{this.templateCache[e]=t.text()})),t}))}}class r{constructor(e){this.context=e,this.userData={user_id:45,token:"some-secret-token",scenes:[{scene_id:1541,name:"Electric",short_code:"16t"},{scene_id:598,name:"Superb",short_code:"gm"},{scene_id:597,name:"Thirsty",short_code:"gl"}]}}onLogin(){}setupSocket(){this.socket=io.connect("https://shanesedit.org",{reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:99999}),this.socket.on("login",e=>{this.onLogin(e)})}}var s=o(1);class l{constructor(e){this.context=e}open(){this.context.breadCrumbs.make([{name:"My Scenes",callback:()=>this.open(),isTop:!0}]),this.context.content.loadScreen("scene-list-view",["scene-item"],!0).then(()=>this.context.content.compileTemplates("scene-item",[{scenes:this.context.session.userData.scenes}])).then(e=>{for(let t=0;t<e.length;t++)this.context.content.addTemplateItem("#sceneList",e[t])}).then(()=>this.context.content.reloadContent()).then(()=>this.setupLoadButtons())}setupLoadButtons(){let e=document.querySelector("#sceneList").querySelectorAll(".loadScene");for(let t=0;t<e.length;t++){let o=e[t];o.addEventListener("mousedown",e=>{let t;for(let e=0;e<this.context.session.userData.scenes.length;e++){let i=this.context.session.userData.scenes[e];if(i.scene_id===Number(o.dataset.scene)){t=i;break}}t&&(t.view_only="true"===o.dataset.view_only,this.context.sceneGraph.load(t).then(()=>this.context.itemView.open()).then(()=>{if(!t.view_only)return this.context.sceneGraph.open()}))})}}}class c{constructor(e){this.context=e}open(e){e=e||this.context.sceneGraph.currentScene,this.isTop=e===this.context.sceneGraph.currentScene,this.context.breadCrumbs.make(this.context.breadCrumbs.fromObject(e)),this.isTop&&this.context.displayBox.hide(),this.isGroup="Object3D"===e.settings.type,this.is3dModel="Poly"===e.settings.type||"Custom"===e.settings.type,this.context.currentObject=e,this.uiRenderer=document.getElementById("mainRenderer"),this.uiRenderer.components["ui-renderer"].pause(),this.context.content.loadScreen("item-view",["title-section","three-number-inputs","object-stats","mobile-response","single-item-button","double-item-button","side-item-add"],!0).then(()=>this.hideNotNeeded()).then(()=>this.showTransformSettings(e)).then(()=>this.context.viewUtils.title(this.isTop?e.metadata.name:e.settings.name,e.settings.uuid)).then(()=>this.context.viewUtils.stats(e)).then(()=>this.context.content.compileTemplates("single-item-button",[{title:"Save Prefab",description:"Save this scene as a prefab to import it later",buttonText:"SAVE PREFAB",descriptionHeight:.21}])).then(e=>this.context.content.addTemplateItem("#savePrefab",e[0])).then(()=>{document.querySelector("#savePrefab").querySelector(".singleButton").addEventListener("mousedown",()=>{this.context.savePrefabModal.open()})}).then(()=>this.showMaterialAndGeometrySettings()).then(()=>this.context.content.compileTemplates("single-item-button",[{title:"Behaviours",description:"Add/update behaviours on the scene",buttonText:"BEHAVIOURS",descriptionHeight:.21}])).then(e=>this.context.content.addTemplateItem("#behavioursContainer",e[0])).then(()=>{document.querySelector("#behavioursContainer").querySelector(".singleButton").addEventListener("mousedown",()=>{this.context.behavioursModal.open()})}).then(()=>this.setupRemoveObject()).then(()=>this.show3dModelSettings()).then(()=>this.setupClearScene()).then(()=>this.setupMobileResponse(e)).then(()=>this.context.content.compileTemplates("side-item-add",[{title:"Objects",buttonText:"ADD OBJECT",children:this.context.currentObject.children.map(e=>this.context.viewUtils.childObject(e))}])).then(e=>this.context.content.addTemplateItem("#childObjectsContainer",e[0])).then(()=>this.setupChildren()).then(()=>this.setupAddItem()).then(()=>this.uiRenderer.components["ui-renderer"].play()).then(()=>this.context.content.reloadContent())}setupRemoveObject(){if(!this.isTop)return this.context.content.compileTemplates("single-item-button",[{title:"Remove",description:"remove this object from the scene.",buttonText:"REMOVE OBJECT",buttonColor:"#e57373",buttonFontColor:"white",descriptionHeight:.21}]).then(e=>this.context.content.addTemplateItem("#removeObject",e[0]))}showMaterialAndGeometrySettings(){if(this.isTop||this.isGroup||this.is3dModel)return;let e="Primitive"===this.context.currentObject.settings.type,t=this.context.currentObject.settings.material,o=this.context.currentObject.settings.geometry;return this.context.content.compileTemplates("double-item-button",[{title:"Material Settings: "+t.type.substr(4,t.type.length-12),description:"Change settings like color and opacity",buttonText:"CHANGE TYPE",buttonTwoText:"MATERIAL SETTINGS",descriptionHeight:.21}]).then(e=>this.context.content.addTemplateItem("#materialSettings",e[0])).then(()=>{document.querySelector("#materialSettings").querySelector(".doubleButton1").addEventListener("mousedown",()=>{this.context.materialTypeModal.open()}),document.querySelector("#materialSettings").querySelector(".doubleButton2").addEventListener("mousedown",()=>{this.context.materialSettingsModal.open()})}).then(()=>this.context.content.compileTemplates("double-item-button",[{title:"Geometry Settings: "+(e?o.type.replace("Geometry","").replace("Buffer","").replace("Inverted",""):"Parametric"),description:"Change the geometry settings for this object",buttonText:"CHANGE TYPE",buttonTwoText:"GEOMETRY SETTINGS",descriptionHeight:.21}])).then(e=>this.context.content.addTemplateItem("#geometrySettings",e[0])).then(()=>{document.querySelector("#geometrySettings").querySelector(".doubleButton1").addEventListener("mousedown",()=>{this.context.geometryTypeModal.open()}),document.querySelector("#geometrySettings").querySelector(".doubleButton2").addEventListener("mousedown",()=>{this.context.geometrySettingsModal.open()})})}setupMobileResponse(e){if(!this.isTop)return this.context.content.compileTemplates("mobile-response",[{hide_on_mobile:e.settings.hide_on_mobile,show_only_on_mobile:e.settings.hide_on_desktop}]).then(e=>this.context.content.addTemplateItem("#mobileSettings",e[0]))}setupClearScene(){if(this.isTop)return this.context.content.compileTemplates("single-item-button",[{title:"Clear Scene",description:"Clear everything out of this scene",buttonText:"CLEAR EVERYTHING",buttonColor:"#e57373",buttonFontColor:"white",descriptionHeight:.21}]).then(e=>this.context.content.addTemplateItem("#clearScene",e[0])).then(()=>{document.querySelector("#clearScene").querySelector(".singleButton").addEventListener("mousedown",()=>{this.context.clearSceneModal.open()})})}showTransformSettings(){if(!this.isTop)return this.context.content.compileTemplates("single-item-button",[{title:"Object Transform",description:"Change position, rotation and scale settings",buttonText:"TRANSFORM SETTINGS",descriptionHeight:.21}]).then(e=>this.context.content.addTemplateItem("#transformSettings",e[0])).then(()=>{document.querySelector("#transformSettings").querySelector(".singleButton").addEventListener("mousedown",()=>{this.context.transformModal.open()})})}show3dModelSettings(){if(this.is3dModel)return this.context.content.compileTemplates("single-item-button",[{title:"Model Settings",description:"Adjust the urls of this model.",buttonText:"MODEL SETTINGS",descriptionHeight:.21}]).then(e=>this.context.content.addTemplateItem("#modelSettings",e[0]))}setupAddItem(){document.querySelector("#childObjectsContainer").querySelector(".loadItem").addEventListener("mousedown",e=>{this.context.objectTypeModal.open()})}setupChildren(){let e=document.querySelector("#childObjectsContainer").querySelectorAll(".openItem");for(let t=0;t<e.length;t++){let o=e[t];o.addEventListener("mousedown",e=>{let t;for(let e=0;e<this.context.currentObject.children.length;e++){let i=this.context.currentObject.children[e];i.settings.uuid===o.dataset.uuid&&(t=i)}t&&(this.context.displayBox.setObject(t.object3D),this.context.itemView.open(t))})}}hideNotNeeded(){if(this.isTop){let e=document.getElementById("transformSettings");e.parentElement.removeChild(e);let t=document.getElementById("geometrySettings");t.parentElement.removeChild(t);let o=document.getElementById("materialSettings");o.parentElement.removeChild(o);let i=document.getElementById("mobileSettings");i.parentElement.removeChild(i);let n=document.getElementById("modelSettings");n.parentElement.removeChild(n);let a=document.getElementById("sceneSettings");a.parentElement.removeChild(a)}else if(this.isGroup){let e=document.getElementById("clearScene");e.parentElement.removeChild(e);let t=document.getElementById("sceneSettings");t.parentElement.removeChild(t);let o=document.getElementById("geometrySettings");o.parentElement.removeChild(o);let i=document.getElementById("materialSettings");i.parentElement.removeChild(i);let n=document.getElementById("modelSettings");n.parentElement.removeChild(n)}else if(this.is3dModel){let e=document.getElementById("clearScene");e.parentElement.removeChild(e);let t=document.getElementById("sceneSettings");t.parentElement.removeChild(t);let o=document.getElementById("geometrySettings");o.parentElement.removeChild(o);let i=document.getElementById("materialSettings");i.parentElement.removeChild(i)}else{let e=document.getElementById("clearScene");e.parentElement.removeChild(e);let t=document.getElementById("sceneSettings");t.parentElement.removeChild(t);let o=document.getElementById("modelSettings");o.parentElement.removeChild(o)}}}o(2),o(4),o(5);class h{constructor(e){this.context=e}open(){}close(){}}var u=o(0);class d{constructor(){this.names={Primitive:"Simple",Parametric:"Fancy",Custom:"3D Model",map:"image"}}show(e){return this.names[e]||e}}class m{constructor(e){this.context=e;let t="images/icons/objects/";this.types=[{name:"Group",friendly_name:"Group",image_url:t+"folder.jpg",extra_class:"close-modal"},{name:"Primitive",friendly_name:"Simple",image_url:t+"geometries/primitive/Box.jpg"},{name:"Parametric",friendly_name:"Fancy",image_url:t+"geometries/parametric/Apple.jpg"},{name:"Prefab",friendly_name:"Prefab",image_url:t+"prefab.jpg"},{name:"Light",friendly_name:"Light",image_url:t+"lights.jpg"},{name:"Poly",friendly_name:"Google Poly",image_url:t+"poly.jpg"},{name:"Sketchfab",friendly_name:"Sketchfab",image_url:t+"sketchfab.jpg"},{name:"Kenney",friendly_name:"Kenney's",image_url:t+"kenny-logo.jpg"},{name:"Avatar",friendly_name:"Avatar Models",image_url:t+"custom.jpg"},{name:"Custom",friendly_name:"Your Model",image_url:t+"custom.jpg"}]}open(){document.getElementById("backButton").setAttribute("scale","0.00001 0.00001 0.00001"),this.uiRenderer=document.getElementById("mainRenderer"),this.uiRenderer.components["ui-renderer"].pause(),this.context.content.loadTemplates(["add-items"]).then(()=>this.context.content.compileTemplates("add-items",[{items:this.types}],!0)).then(e=>{this.context.content.popup.setContent(e[0])}).then(()=>this.uiRenderer.components["ui-renderer"].play()).then(()=>{let e=this.context.content.popup.querySelectorAll(".type-select");for(let t=0;t<e.length;t++){let o=e[t];o.addEventListener("mousedown",()=>{switch(this.context.popupBackStack.push(()=>this.open()),document.getElementById("backButton").setAttribute("scale","1 1 1"),o.dataset.key){case"Primitive":this.context.primitiveTypeModal.open();break;case"Parametric":this.context.parametricTypeModal.open();break;case"Prefab":this.context.prefabOptionModal.open();break;case"Light":this.context.lightTypeModal.open();break;case"Kenney":this.context.kennyCategories.open();break;case"Avatar":this.context.avatarCategories.open();break;case"Group":this.context.sceneGraph.add(this.context.sceneGraph.currentScene,{type:"Object3D"}),this.uiRenderer.modal.close()}})}})}}class p{constructor(e){this.context=e;let t="images/icons/objects/geometries/primitive/";this.types=[{name:"Box",friendly_name:"Box",image_url:t+"Box.jpg"},{name:"Circle",friendly_name:"Circle",image_url:t+"Circle.jpg"},{name:"Cone",friendly_name:"Cone",image_url:t+"Cone.jpg"},{name:"Cylinder",friendly_name:"Cylinder",image_url:t+"Cylinder.jpg"},{name:"Dodecahedron",friendly_name:"Dodecahedron",image_url:t+"Dodecahedron.jpg"},{name:"Icosahedron",friendly_name:"Icosahedron",image_url:t+"Icosahedron.jpg"},{name:"Octahedron",friendly_name:"Octahedron",image_url:t+"Octahedron.jpg"},{name:"Plane",friendly_name:"Plane",image_url:t+"Plane.jpg"},{name:"Ring",friendly_name:"Ring",image_url:t+"Ring.jpg"},{name:"Sphere",friendly_name:"Sphere",image_url:t+"Sphere.jpg"},{name:"Tetrahedron",friendly_name:"Tetrahedron",image_url:t+"Tetrahedron.jpg"},{name:"Torus",friendly_name:"Torus",image_url:t+"Torus.jpg"},{name:"TorusKnot",friendly_name:"TorusKnot",image_url:t+"TorusKnot.jpg"}]}open(){this.context.content.compileTemplates("add-items",[{items:this.types}],!0).then(e=>this.context.content.popup.setContent(e[0])).then(()=>{let e=this.context.content.popup.querySelectorAll(".type-select");for(let t=0;t<e.length;t++){let o=e[t];o.addEventListener("mousedown",()=>{this.context.objectMaterial.open({type:"Primitive",sub_type:o.dataset.key+"Geometry"})})}})}}class b{constructor(e){this.context=e;let t="images/icons/objects/geometries/parametric/";this.types=[{name:"My Parametrics",friendly_name:"My Fancys",image_url:"images/icons/objects/parametric.jpg"},{name:"Parametric Market",friendly_name:"Fancy Market",image_url:"images/icons/objects/market.jpg"},{name:"Create",friendly_name:"Create",image_url:"images/icons/objects/custom.jpg"},{name:"Apple",friendly_name:"Apple",image_url:t+"Apple.jpg"},{name:"AppleInverted",friendly_name:"Apple Inverted",image_url:t+"Apple.jpg"},{name:"Catenoid",friendly_name:"Catenoid",image_url:t+"Catenoid.jpg"},{name:"Fermat",friendly_name:"Fermat",image_url:t+"Fermat.jpg"},{name:"Helicoid",friendly_name:"Helicoid",image_url:t+"Helicoid.jpg"},{name:"Horn",friendly_name:"Horn",image_url:t+"Horn.jpg"},{name:"HornInverted",friendly_name:"Horn Inverted",image_url:t+"Horn.jpg"},{name:"Klein",friendly_name:"Klein",image_url:t+"Klein.jpg"},{name:"KleinInverted",friendly_name:"Klein Inverted",image_url:t+"Klein.jpg"},{name:"Mobius",friendly_name:"Mobius",image_url:t+"Mobius.jpg"},{name:"Mobius3D",friendly_name:"Mobius3D",image_url:t+"Mobius3D.jpg"},{name:"Mobius3DInverted",friendly_name:"Mobius3D Inverted",image_url:t+"Mobius3D.jpg"},{name:"Pillow",friendly_name:"Pillow",image_url:t+"Pillow.jpg"},{name:"PillowInverted",friendly_name:"Pillow Inverted",image_url:t+"Pillow.jpg"},{name:"NaticaStellata",friendly_name:"Natica",image_url:t+"NaticaStellata.jpg"},{name:"NaticaStellataInverted",friendly_name:"Natica Inverted",image_url:t+"NaticaStellata.jpg"},{name:"Scherk",friendly_name:"Scherk",image_url:t+"Scherk.jpg"},{name:"Snail",friendly_name:"Snail",image_url:t+"Snail.jpg"},{name:"SnailInverted",friendly_name:"Snail Inverted",image_url:t+"Snail.jpg"},{name:"Spiral",friendly_name:"Spiral",image_url:t+"Spiral.jpg"},{name:"SpiralInverted",friendly_name:"Spiral Inverted",image_url:t+"Spiral.jpg"},{name:"Spring",friendly_name:"Spring",image_url:t+"Spring.jpg"},{name:"SpringInverted",friendly_name:"Spring Inverted",image_url:t+"Spring.jpg"}]}open(){this.context.content.compileTemplates("add-items",[{items:this.types}],!0).then(e=>this.context.content.popup.setContent(e[0])).then(()=>{let e=this.context.content.popup.querySelectorAll(".type-select");for(let t=0;t<e.length;t++){let o=e[t];o.addEventListener("mousedown",()=>{this.context.objectMaterial.open({type:"Parametric",sub_type:o.dataset.key,geo_settings:{sub_type:o.dataset.key+"Geometry"}})})}})}}class g{constructor(e){this.context=e,this.types=[{name:"Spot",friendly_name:"Spot",image_url:"images/icons/objects/lights.jpg"},{name:"Ambient",friendly_name:"Ambient",image_url:"images/icons/objects/lights.jpg"},{name:"Directional",friendly_name:"Directional",image_url:"images/icons/objects/lights.jpg"}]}open(){this.context.content.compileTemplates("add-items",[{items:this.types}],!0).then(e=>this.context.content.popup.setContent(e[0]))}}class j{constructor(e){this.context=e,this.types=[{name:"My Prefabs",friendly_name:"My Prefabs",image_url:"images/icons/objects/prefab.jpg"},{name:"Prefab Market",friendly_name:"Prefab Market",image_url:"images/icons/objects/market.jpg"}]}open(){this.context.content.compileTemplates("add-items",[{items:this.types}],!0).then(e=>this.context.content.popup.setContent(e[0]))}}class _{constructor(e){this.context=e,this.types=[{name:"3d-nature-pack",friendly_name:"3D Nature",image_url:"images/kenney/3d-nature-pack/Sample.png"},{name:"3d-road-pack",friendly_name:"3D Roads",image_url:"images/kenney/3d-road-pack/Sample.png"},{name:"castle-kit-1.0",friendly_name:"Castle Kit",image_url:"images/kenney/castle-kit-1.0/Sample.png"},{name:"kenney_furniturepack",friendly_name:"Furniture",image_url:"images/kenney/kenney_furniturepack/Sample.png"},{name:"kenney_holidaypack",friendly_name:"Holiday",image_url:"images/kenney/kenney_holidaypack/Sample.png"},{name:"medieval-town-base",friendly_name:"Medieval",image_url:"images/kenney/medieval-town-base/Sample.png"},{name:"modular-buildings-100-assets",friendly_name:"Buildings",image_url:"images/kenney/modular-buildings-100-assets/Sample.png"},{name:"naturepack_extended",friendly_name:"Nature",image_url:"images/kenney/naturepack_extended/Sample.png"},{name:"racing-kit-1.2",friendly_name:"Racing",image_url:"images/kenney/racing-kit-1.2/Sample.png"},{name:"space-kit-1.0",friendly_name:"Space",image_url:"images/kenney/space-kit-1.0/Sample.png"},{name:"watercraftpack_kenney",friendly_name:"Water Craft",image_url:"images/kenney/watercraftpack_kenney/Sample.png"},{name:"weaponpack_assets",friendly_name:"Weapons",image_url:"images/kenney/weaponpack_assets/Sample.png"}]}open(){this.context.content.compileTemplates("add-items",[{top_image_url:"images/kenney/kenny_banner.png",items:this.types}],!0).then(e=>this.context.content.popup.setContent(e[0])).then(()=>{let e=this.context.content.popup.querySelectorAll(".type-select");for(let t=0;t<e.length;t++){let o=e[t];o.addEventListener("mousedown",()=>{this.context.popupBackStack.push(()=>this.open()),document.getElementById("backButton").setAttribute("scale","1 1 1"),this.context.kennyModelsModal.open(o.dataset.key)})}})}}class y{constructor(e){this.context=e,this.types={"3d-nature-pack":["Brown_Cliff_01.obj","Brown_Cliff_Bottom_01.obj","Brown_Cliff_Bottom_Corner_01.obj","Brown_Cliff_Bottom_Corner_Green_Top_01.obj","Brown_Cliff_Bottom_Green_Top_01.obj","Brown_Cliff_Corner_01.obj","Brown_Cliff_Corner_Green_Top_01.obj","Brown_Cliff_End_01.obj","Brown_Cliff_End_Green_Top_01.obj","Brown_Cliff_Green_Top_01.obj","Brown_Cliff_Top_01.obj","Brown_Cliff_Top_Corner_01.obj","Brown_Waterfall_01.obj","Brown_Waterfall_Top_01.obj","Campfire_01.obj","Fallen_Trunk_01.obj","Flower_Red_01.obj","Flower_Tall_Red_01.obj","Flower_Tall_Yellow_01.obj","Flower_Tall_Yellow_02.obj","Flower_Yellow_01.obj","Flower_Yellow_02.obj","Grass_01.obj","Grey_Cliff_01.obj","Grey_Cliff_Bottom_01.obj","Grey_Cliff_Bottom_Corner_01.obj","Grey_Cliff_Bottom_Corner_Green_Top_01.obj","Grey_Cliff_Bottom_Green_Top_01.obj","Grey_Cliff_Corner_01.obj","Grey_Cliff_Corner_Green_Top_01.obj","Grey_Cliff_End_01.obj","Grey_Cliff_End_Green_Top_01.obj","Grey_Cliff_Green_Top_01.obj","Grey_Cliff_Top_01.obj","Grey_Cliff_Top_Corner_01.obj","Grey_Waterfall_01.obj","Grey_Waterfall_Top_01.obj","Large_Oak_Dark_01.obj","Large_Oak_Fall_01.obj","Large_Oak_Green_01.obj","Mushroom_Brown_01.obj","Mushroom_Red_01.obj","Mushroom_Tall_01.obj","Oak_Dark_01.obj","Oak_Fall_01.obj","Oak_Green_01.obj","Plant_1_01.obj","Plant_2_01.obj","Plant_3_01.obj","Plate_Grass_01.obj","Plate_Grass_Dirt_01.obj","Plate_River_01.obj","Plate_River_Corner_01.obj","Plate_River_Corner_Dirt_01.obj","Plate_River_Dirt_01.obj","Rock_1_01.obj","Rock_2_01.obj","Rock_3_01.obj","Rock_4_01.obj","Rock_5_01.obj","Rock_6_01.obj","Tall_Rock_1_01.obj","Tall_Rock_2_01.obj","Tall_Rock_3_01.obj","Tent_01.obj","Tent_Poles_01.obj","Tree_01.obj","Tree_02.obj","Trunk_01.obj","Trunk_02.obj","Trunk_Alt_01.obj","Trunk_Alt_02.obj","Water_lily_01.obj","Wood_Fence_01.obj","Wood_Fence_Broken_01.obj","Wood_Fence_Gate_01.obj"],"3d-road-pack":["roadTile_001.obj","roadTile_002.obj","roadTile_003.obj","roadTile_005.obj","roadTile_006.obj","roadTile_007.obj","roadTile_008.obj","roadTile_009.obj","roadTile_010.obj","roadTile_011.obj","roadTile_012.obj","roadTile_013.obj","roadTile_014.obj","roadTile_015.obj","roadTile_016.obj","roadTile_017.obj","roadTile_018.obj","roadTile_019.obj","roadTile_020.obj","roadTile_021.obj","roadTile_022.obj","roadTile_023.obj","roadTile_024.obj","roadTile_025.obj","roadTile_026.obj","roadTile_027.obj","roadTile_028.obj","roadTile_029.obj","roadTile_030.obj","roadTile_031.obj","roadTile_032.obj","roadTile_033.obj","roadTile_034.obj","roadTile_035.obj","roadTile_036.obj","roadTile_037.obj","roadTile_038.obj","roadTile_039.obj","roadTile_040.obj","roadTile_041.obj","roadTile_042.obj","roadTile_043.obj","roadTile_044.obj","roadTile_045.obj","roadTile_046.obj","roadTile_047.obj","roadTile_048.obj","roadTile_049.obj","roadTile_050.obj","roadTile_051.obj","roadTile_052.obj","roadTile_053.obj","roadTile_054.obj","roadTile_055.obj","roadTile_056.obj","roadTile_057.obj","roadTile_058.obj","roadTile_059.obj","roadTile_060.obj","roadTile_061.obj","roadTile_062.obj","roadTile_063.obj","roadTile_064.obj","roadTile_065.obj","roadTile_066.obj","roadTile_067.obj","roadTile_068.obj","roadTile_069.obj","roadTile_070.obj","roadTile_071.obj","roadTile_072.obj","roadTile_073.obj","roadTile_074.obj","roadTile_075.obj","roadTile_076.obj","roadTile_077.obj","roadTile_078.obj","roadTile_079.obj","roadTile_080.obj","roadTile_081.obj","roadTile_082.obj","roadTile_083.obj","roadTile_084.obj","roadTile_085.obj","roadTile_086.obj","roadTile_087.obj","roadTile_088.obj","roadTile_089.obj","roadTile_090.obj","roadTile_091.obj","roadTile_092.obj","roadTile_093.obj","roadTile_094.obj","roadTile_095.obj","roadTile_096.obj","roadTile_097.obj","roadTile_098.obj","roadTile_099.obj","roadTile_100.obj","roadTile_101.obj","roadTile_102.obj","roadTile_103.obj","roadTile_104.obj","roadTile_105.obj","roadTile_106.obj","roadTile_107.obj","roadTile_108.obj","roadTile_109.obj","roadTile_110.obj","roadTile_111.obj","roadTile_112.obj","roadTile_113.obj","roadTile_114.obj","roadTile_115.obj","roadTile_116.obj","roadTile_117.obj","roadTile_118.obj","roadTile_119.obj","roadTile_120.obj","roadTile_121.obj","roadTile_122.obj","roadTile_123.obj","roadTile_124.obj","roadTile_125.obj","roadTile_126.obj","roadTile_127.obj","roadTile_128.obj","roadTile_129.obj","roadTile_130.obj","roadTile_131.obj","roadTile_132.obj","roadTile_133.obj","roadTile_134.obj","roadTile_135.obj","roadTile_136.obj","roadTile_137.obj","roadTile_138.obj","roadTile_139.obj","roadTile_140.obj","roadTile_141.obj","roadTile_142.obj","roadTile_143.obj","roadTile_144.obj","roadTile_145.obj","roadTile_146.obj","roadTile_147.obj","roadTile_148.obj","roadTile_149.obj","roadTile_150.obj","roadTile_151.obj","roadTile_152.obj","roadTile_153.obj","roadTile_154.obj","roadTile_155.obj","roadTile_156.obj","roadTile_157.obj","roadTile_158.obj","roadTile_159.obj","roadTile_160.obj","roadTile_161.obj","roadTile_162.obj","roadTile_163.obj","roadTile_164.obj","roadTile_165.obj","roadTile_166.obj","roadTile_167.obj","roadTile_168.obj","roadTile_169.obj","roadTile_170.obj","roadTile_171.obj","roadTile_172.obj","roadTile_173.obj","roadTile_174.obj","roadTile_175.obj","roadTile_176.obj","roadTile_177.obj","roadTile_178.obj","roadTile_179.obj","roadTile_180.obj","roadTile_181.obj","roadTile_182.obj","roadTile_183.obj","roadTile_184.obj","roadTile_185.obj","roadTile_186.obj","roadTile_187.obj","roadTile_188.obj","roadTile_189.obj","roadTile_190.obj","roadTile_191.obj","roadTile_192.obj","roadTile_193.obj","roadTile_194.obj","roadTile_195.obj","roadTile_196.obj","roadTile_197.obj","roadTile_198.obj","roadTile_199.obj","roadTile_200.obj","roadTile_201.obj","roadTile_202.obj","roadTile_203.obj","roadTile_204.obj","roadTile_205.obj","roadTile_206.obj","roadTile_207.obj","roadTile_208.obj","roadTile_209.obj","roadTile_210.obj","roadTile_211.obj","roadTile_212.obj","roadTile_213.obj","roadTile_214.obj","roadTile_215.obj","roadTile_216.obj","roadTile_217.obj","roadTile_218.obj","roadTile_219.obj","roadTile_220.obj","roadTile_221.obj","roadTile_222.obj","roadTile_223.obj","roadTile_224.obj","roadTile_225.obj","roadTile_226.obj","roadTile_227.obj","roadTile_228.obj","roadTile_229.obj","roadTile_230.obj","roadTile_231.obj","roadTile_232.obj","roadTile_233.obj","roadTile_234.obj","roadTile_235.obj","roadTile_236.obj","roadTile_237.obj","roadTile_238.obj","roadTile_239.obj","roadTile_240.obj","roadTile_241.obj","roadTile_242.obj","roadTile_243.obj","roadTile_244.obj","roadTile_245.obj","roadTile_246.obj","roadTile_247.obj","roadTile_248.obj","roadTile_249.obj","roadTile_250.obj","roadTile_251.obj","roadTile_252.obj","roadTile_253.obj","roadTile_254.obj","roadTile_255.obj","roadTile_256.obj","roadTile_257.obj","roadTile_258.obj","roadTile_259.obj","roadTile_260.obj","roadTile_261.obj","roadTile_262.obj","roadTile_263.obj","roadTile_264.obj","roadTile_265.obj","roadTile_266.obj","roadTile_267.obj","roadTile_268.obj","roadTile_269.obj","roadTile_270.obj","roadTile_271.obj","roadTile_272.obj","roadTile_273.obj","roadTile_274.obj","roadTile_275.obj","roadTile_276.obj","roadTile_277.obj","roadTile_278.obj","roadTile_279.obj","roadTile_280.obj","roadTile_281.obj","roadTile_282.obj","roadTile_283.obj","roadTile_284.obj","roadTile_285.obj","roadTile_286.obj","roadTile_287.obj","roadTile_288.obj","roadTile_289.obj","roadTile_290.obj","roadTile_291.obj","roadTile_292.obj","roadTile_293.obj","roadTile_294.obj","roadTile_295.obj","roadTile_296.obj","roadTile_297.obj","roadTile_298.obj","roadTile_299.obj","roadTile_300.obj","roadTile_301.obj","roadTile_302.obj"],"castle-kit-1.0":["bridge.obj","door.obj","flagBannerLong.obj","flagBannerShort.obj","flagBlue.obj","flagBlueWide.obj","flagWhite.obj","flagWhiteWide.obj","gate.obj","king.obj","knightBlue.obj","knightRed.obj","metalGate.obj","shieldBlue.obj","shieldRed.obj","siegeBallista.obj","siegeCatapult.obj","siegeRam.obj","siegeTower.obj","siegeTrebuchet.obj","stairsStone.obj","stairsStoneSlant.obj","sword.obj","towerBalcony.obj","towerBase.obj","towerSquare.obj","towerSquareArch.obj","towerSquareBase.obj","towerSquareBaseBorder.obj","towerSquareBaseColor.obj","towerSquareMid.obj","towerSquareMidColor.obj","towerSquareMidOpen.obj","towerSquareMidOpenHalf.obj","towerSquareMidWindows.obj","towerSquarePoles.obj","towerSquareRoof.obj","towerSquareTop.obj","towerSquareTopColor.obj","towerSquareTopRoof.obj","towerSquareTopRoofHigh.obj","towerTop.obj","towerTopCorner.obj","towerTopRoof.obj","wall.obj","wallCorner.obj","wallCornerHalf.obj","wallCornerHalfTower.obj","wallDoor.obj","wallHalf.obj","wallNarrow.obj","wallNarrowCorner.obj","wallNarrowGate.obj","wallNarrowStairs.obj","wallNarrowStairsFence.obj","wallNarrowWood.obj","wallNarrowWoodFence.obj","wallPillar.obj","wallStud.obj","wallToNarrow.obj"],kenney_furniturepack:["bathroomCabinet.obj","bathroomMirror.obj","bathroomSink.obj","bathtub.obj","bear.obj","bedBunk.obj","bedDouble.obj","bedSingle.obj","bench.obj","benchCushion.obj","benchCushionLow.obj","bookcaseClosed.obj","bookcaseClosedDoors.obj","bookcaseClosedWide.obj","bookcaseOpen.obj","bookcaseOpenLow.obj","books.obj","cabinetBed.obj","cabinetBedDrawer.obj","cabinetBedDrawerTable.obj","cabinetTelevision.obj","cabinetTelevisionDoors.obj","cardboardBoxClosed.obj","cardboardBoxOpen.obj","ceilingFan.obj","chair.obj","chairCushion.obj","chairDesk.obj","chairRounded.obj","coatRack.obj","coatRackStanding.obj","computerKeyboard.obj","computerMouse.obj","computerScreen.obj","desk.obj","deskCorner.obj","doorway.obj","doorwayFront.obj","doorwayOpen.obj","dryer.obj","floorCorner.obj","floorCornerRound.obj","floorFull.obj","floorHalf.obj","kitchenBar.obj","kitchenBarEnd.obj","kitchenBlender.obj","kitchenCabinet.obj","kitchenCabinetCornerInner.obj","kitchenCabinetCornerRound.obj","kitchenCabinetDrawer 1.obj","kitchenCabinetDrawer.obj","kitchenCabinetUpper.obj","kitchenCabinetUpperCorner.obj","kitchenCabinetUpperDouble.obj","kitchenCabinetUpperLow.obj","kitchenCoffeeMachine.obj","kitchenFridge.obj","kitchenFridgeBuiltIn.obj","kitchenFridgeSmall.obj","kitchenMicrowave.obj","kitchenSink.obj","kitchenStove.obj","kitchenStoveElectric.obj","lampRoundFloor.obj","lampRoundTable.obj","lampSquareCeiling.obj","lampSquareFloor.obj","lampSquareTable.obj","laptop.obj","loungeChair.obj","loungeChairRelax.obj","loungeSofa.obj","loungeSofaCorner.obj","loungeSofaLong.obj","loungeSofaOttoman.obj","paneling.obj","pillow.obj","pillowLong.obj","plantSmall1.obj","plantSmall2.obj","plantSmall3.obj","pottedPlant.obj","radio.obj","rugRectangle.obj","rugRound.obj","rugRounded.obj","rugSquare.obj","shower.obj","sideTable.obj","sideTableDrawers.obj","speaker.obj","speakerSmall.obj","stoolBar.obj","stoolBarSquare.obj","table.obj","tableCloth.obj","tableCoffee.obj","tableCoffeeGlass.obj","tableCoffeeGlassSquare.obj","tableCoffeeSquare.obj","tableCross.obj","tableCrossCloth.obj","tableGlass.obj","tableRound.obj","televisionAntenna.obj","televisionModern.obj","televisionVintage.obj","toilet.obj","trashcan.obj","wall.obj","wallCorner.obj","wallCornerRond.obj","wallDoorway.obj","wallDoorwayWide.obj","wallHalf.obj","wallWindow.obj","wallWindowSlide.obj","washer.obj","washerDryerStacked.obj"],kenney_holidaypack:["cabinCorner.obj","cabinDoor.obj","cabinFloor.obj","cabinRoof.obj","cabinRoofChimney.obj","cabinSide.obj","cabinWall.obj","cabinWindow.obj","candyCane.obj","candyCaneMint.obj","festivusPole.obj","lightsGreen.obj","lightsMulti.obj","lightsRed.obj","present.obj","presentLow.obj","presentRound.obj","rockFormationLarge.obj","rockFormationMedium.obj","rockFormationSmall.obj","sled.obj","snowFort.obj","snowPatch.obj","snowman.obj","snowmanFancy.obj","trackCorner.obj","trackCornerLarge.obj","trackStraight.obj","trainLocomotive.obj","trainTender.obj","trainWagon.obj","trainWagonFlat.obj","treeDecorated.obj","treePine.obj","treePineSnow.obj","treePineSnowRound.obj","treePineSnowed.obj","wreath.obj"],"medieval-town-base":["Banner_01.obj","Castle_Wall_01.obj","Grey_Arch_01.obj","Grey_Border_Wall_01.obj","Grey_Broken_Wall_01.obj","Grey_Corner_01.obj","Grey_Door_Round_01.obj","Grey_Door_Square_01.obj","Grey_Pole_01.obj","Grey_Short_Wall_01.obj","Grey_Slanted_Pole_01.obj","Grey_Slanted_Wall_01.obj","Grey_Small_Wall_01.obj","Grey_Triangle_01.obj","Grey_Wall_01.obj","Grey_Window_Narrow_01.obj","Grey_Window_Round_01.obj","Grey_Window_Round_Long_01.obj","Grey_Window_Round_Sill_01.obj","Grey_Window_Square_01.obj","Grey_Window_Square_Sill_01.obj","Iron_Door_01.obj","Lightpost_01.obj","Plate_Corner_01.obj","Plate_Curve_01.obj","Plate_Pavement_01.obj","Plate_Road_01.obj","Plate_Sidewalk_01.obj","Plate_Wood_01.obj","Roof_Corner_Green_01.obj","Roof_Corner_Red_01.obj","Roof_Inner_Corner_Green_01.obj","Roof_Inner_Corner_Red_01.obj","Roof_Point_Green_01.obj","Roof_Point_Red_01.obj","Roof_Slant_Green_01.obj","Roof_Slant_Red_01.obj","Roof_Straight_Green_01.obj","Roof_Straight_Red_01.obj","Shield_Green_01.obj","Shield_Red_01.obj","Stairs_Stone_01.obj","Stairs_Wood_01.obj","Tree_01.obj","Wood_Arch_01.obj","Wood_Border_Wall_01.obj","Wood_Broken_Wall_01.obj","Wood_Corner_01.obj","Wood_Door_01.obj","Wood_Door_Round_01.obj","Wood_Door_Square_01.obj","Wood_Pole_01.obj","Wood_Railing_01.obj","Wood_Slanted_Pole_01.obj","Wood_Slanted_Wall_01.obj","Wood_Small_Wall_01.obj","Wood_Tiny_Wall_01.obj","Wood_Triangle_01.obj","Wood_Wall_01.obj","Wood_Wall_Cross_01.obj","Wood_Wall_Double_Cross_01.obj","Wood_Window_Narrow_01.obj","Wood_Window_Round_01.obj","Wood_Window_Round_Long_01.obj","Wood_Window_Round_Sill_01.obj","Wood_Window_Square_01.obj","Wood_Window_Square_Sill_01.obj"],"modular-buildings-100-assets":["modularBuildings_001.obj","modularBuildings_002.obj","modularBuildings_003.obj","modularBuildings_004.obj","modularBuildings_005.obj","modularBuildings_006.obj","modularBuildings_007.obj","modularBuildings_008.obj","modularBuildings_009.obj","modularBuildings_010.obj","modularBuildings_011.obj","modularBuildings_012.obj","modularBuildings_013.obj","modularBuildings_014.obj","modularBuildings_015.obj","modularBuildings_016.obj","modularBuildings_017.obj","modularBuildings_018.obj","modularBuildings_019.obj","modularBuildings_020.obj","modularBuildings_021.obj","modularBuildings_022.obj","modularBuildings_023.obj","modularBuildings_024.obj","modularBuildings_025.obj","modularBuildings_026.obj","modularBuildings_027.obj","modularBuildings_028.obj","modularBuildings_029.obj","modularBuildings_030.obj","modularBuildings_031.obj","modularBuildings_032.obj","modularBuildings_033.obj","modularBuildings_034.obj","modularBuildings_035.obj","modularBuildings_036.obj","modularBuildings_037.obj","modularBuildings_038.obj","modularBuildings_039.obj","modularBuildings_040.obj","modularBuildings_041.obj","modularBuildings_042.obj","modularBuildings_043.obj","modularBuildings_044.obj","modularBuildings_045.obj","modularBuildings_046.obj","modularBuildings_047.obj","modularBuildings_048.obj","modularBuildings_049.obj","modularBuildings_050.obj","modularBuildings_051.obj","modularBuildings_052.obj","modularBuildings_053.obj","modularBuildings_054.obj","modularBuildings_055.obj","modularBuildings_056.obj","modularBuildings_057.obj","modularBuildings_058.obj","modularBuildings_059.obj","modularBuildings_060.obj","modularBuildings_061.obj","modularBuildings_062.obj","modularBuildings_063.obj","modularBuildings_064.obj","modularBuildings_065.obj","modularBuildings_066.obj","modularBuildings_067.obj","modularBuildings_068.obj","modularBuildings_069.obj","modularBuildings_070.obj","modularBuildings_071.obj","modularBuildings_072.obj","modularBuildings_073.obj","modularBuildings_074.obj","modularBuildings_075.obj","modularBuildings_076.obj","modularBuildings_077.obj","modularBuildings_078.obj","modularBuildings_079.obj","modularBuildings_080.obj","modularBuildings_081.obj","modularBuildings_082.obj","modularBuildings_083.obj","modularBuildings_084.obj","modularBuildings_085.obj","modularBuildings_086.obj","modularBuildings_087.obj","modularBuildings_088.obj","modularBuildings_089.obj","modularBuildings_090.obj","modularBuildings_091.obj","modularBuildings_092.obj","modularBuildings_093.obj","modularBuildings_094.obj","modularBuildings_095.obj","modularBuildings_096.obj","modularBuildings_097.obj","modularBuildings_098.obj","modularBuildings_099.obj","modularBuildings_100.obj","modularBuildings_101.obj","roadTile_004.obj"],naturepack_extended:["naturePack_001.obj","naturePack_002.obj","naturePack_003.obj","naturePack_004.obj","naturePack_005.obj","naturePack_006.obj","naturePack_007.obj","naturePack_008.obj","naturePack_009.obj","naturePack_010.obj","naturePack_011.obj","naturePack_012.obj","naturePack_013.obj","naturePack_014.obj","naturePack_015.obj","naturePack_016.obj","naturePack_017.obj","naturePack_018.obj","naturePack_019.obj","naturePack_020.obj","naturePack_021.obj","naturePack_022.obj","naturePack_023.obj","naturePack_024.obj","naturePack_025.obj","naturePack_026.obj","naturePack_027.obj","naturePack_028.obj","naturePack_029.obj","naturePack_030.obj","naturePack_031.obj","naturePack_032.obj","naturePack_033.obj","naturePack_034.obj","naturePack_035.obj","naturePack_036.obj","naturePack_037.obj","naturePack_038.obj","naturePack_039.obj","naturePack_040.obj","naturePack_041.obj","naturePack_042.obj","naturePack_043.obj","naturePack_044.obj","naturePack_045.obj","naturePack_046.obj","naturePack_047.obj","naturePack_048.obj","naturePack_049.obj","naturePack_050.obj","naturePack_051.obj","naturePack_052.obj","naturePack_053.obj","naturePack_054.obj","naturePack_055.obj","naturePack_056.obj","naturePack_057.obj","naturePack_058.obj","naturePack_059.obj","naturePack_060.obj","naturePack_061.obj","naturePack_062.obj","naturePack_063.obj","naturePack_064.obj","naturePack_065.obj","naturePack_066.obj","naturePack_067.obj","naturePack_068.obj","naturePack_069.obj","naturePack_070.obj","naturePack_071.obj","naturePack_072.obj","naturePack_073.obj","naturePack_074.obj","naturePack_075.obj","naturePack_076.obj","naturePack_077.obj","naturePack_078.obj","naturePack_079.obj","naturePack_080.obj","naturePack_081.obj","naturePack_082.obj","naturePack_083.obj","naturePack_084.obj","naturePack_085.obj","naturePack_086.obj","naturePack_087.obj","naturePack_088.obj","naturePack_089.obj","naturePack_090.obj","naturePack_091.obj","naturePack_092.obj","naturePack_093.obj","naturePack_094.obj","naturePack_095.obj","naturePack_096.obj","naturePack_097.obj","naturePack_098.obj","naturePack_099.obj","naturePack_100.obj","naturePack_101.obj","naturePack_102.obj","naturePack_103.obj","naturePack_104.obj","naturePack_105.obj","naturePack_106.obj","naturePack_107.obj","naturePack_108.obj","naturePack_109.obj","naturePack_110.obj","naturePack_111.obj","naturePack_112.obj","naturePack_113.obj","naturePack_114.obj","naturePack_115.obj","naturePack_116.obj","naturePack_117.obj","naturePack_118.obj","naturePack_119.obj","naturePack_120.obj","naturePack_121.obj","naturePack_122.obj","naturePack_123.obj","naturePack_124.obj","naturePack_125.obj","naturePack_126.obj","naturePack_127.obj","naturePack_128.obj","naturePack_129.obj","naturePack_130.obj","naturePack_131.obj","naturePack_132.obj","naturePack_133.obj","naturePack_134.obj","naturePack_135.obj","naturePack_136.obj","naturePack_137.obj","naturePack_138.obj","naturePack_139.obj","naturePack_140.obj","naturePack_141.obj","naturePack_142.obj","naturePack_143.obj","naturePack_144.obj","naturePack_145.obj","naturePack_146.obj","naturePack_147.obj","naturePack_148.obj","naturePack_149.obj","naturePack_150.obj","naturePack_151.obj","naturePack_152.obj","naturePack_153.obj","naturePack_154.obj","naturePack_155.obj","naturePack_156.obj","naturePack_157.obj","naturePack_158.obj","naturePack_159.obj","naturePack_160.obj","naturePack_161.obj","naturePack_162.obj","naturePack_163.obj","naturePack_164.obj","naturePack_165.obj","naturePack_166.obj","naturePack_167.obj","naturePack_168.obj","naturePack_169.obj","naturePack_170.obj","naturePack_171.obj","naturePack_172.obj","naturePack_173.obj","naturePack_174.obj","naturePack_175.obj","naturePack_flat_001.obj","naturePack_flat_002.obj","naturePack_flat_003.obj","naturePack_flat_004.obj","naturePack_flat_005.obj","naturePack_flat_006.obj","naturePack_flat_007.obj","naturePack_flat_008.obj","naturePack_flat_009.obj","naturePack_flat_010.obj","naturePack_flat_011.obj","naturePack_flat_012.obj","naturePack_flat_013.obj"],"racing-kit-1.2":["barrierRed.obj","barrierWall.obj","barrierWhite.obj","billboard.obj","billboardLow.obj","billboardLower.obj","fenceCurved.obj","fenceStraight.obj","flagCheckers.obj","flagCheckersSmall.obj","flagGreen.obj","flagRed.obj","flagTankco.obj","grandStand.obj","grandStandCovered.obj","grass.obj","lightColored.obj","lightRed.obj","lightRedDouble.obj","overhead.obj","overheadLights.obj","overheadRound.obj","overheadRoundColored.obj","pitsGarage.obj","pitsGarageCorner.obj","pitsOffice.obj","pitsOfficeCorner.obj","pylon.obj","radarEquipment.obj","rail.obj","ramp.obj","roadBump.obj","roadCornerLarge.obj","roadCornerLargeBorder.obj","roadCornerLargeBorderInner.obj","roadCornerLarger.obj","roadCornerLargerBorder.obj","roadCornerLargerBorderInner.obj","roadCornerSmall.obj","roadCornerSmallBorder.obj","roadCornerSmallSquare.obj","roadCurved.obj","roadEnd.obj","roadHalfCircle.obj","roadHalfCircleBorder.obj","roadPitEntry.obj","roadPitGarage.obj","roadPitStraight.obj","roadPitStraightLong.obj","roadRamp.obj","roadRampLong.obj","roadRampLongCurved.obj","roadRampLongCurvedWall.obj","roadRampLongWall.obj","roadRampWall.obj","roadSplit.obj","roadStart.obj","roadStartPositions.obj","roadStraight.obj","roadStraightArrow.obj","roadStraightBridge.obj","roadStraightBridgeMid.obj","roadStraightBridgeStart.obj","roadStraightLong.obj","roadStraightSkew.obj","tent.obj","tentClosed.obj","tentClosedLong.obj","tentLong.obj","treeLarge.obj","treeSmall.obj"],"space-kit-1.0":["alien.obj","alienBones.obj","astronaut.obj","barrel.obj","barrelLarge.obj","buildingCorner.obj","buildingCorridor.obj","buildingCorridorOpen.obj","buildingCorridorOpenEnd.obj","buildingOpen.obj","console.obj","consoleCorner.obj","consoleScreen.obj","crater.obj","craterLarge.obj","frameHigh.obj","frameHighTile.obj","frameLow.obj","frameLowTile.obj","groundTile.obj","groundTileRough.obj","itemWeapon.obj","laserSabel.obj","laserSabelOff.obj","metalFence.obj","metalFenceCorner.obj","metalFenceDouble.obj","metalStructure.obj","metalStructureBottom.obj","metalStructureCross.obj","metalTile.obj","metalTileConnectCenter.obj","metalTileConnectCorner.obj","metalTileConnectCornerInner.obj","metalTileConnectEnd.obj","metalTileConnectSide.obj","metalTileConnectStraight.obj","metalTileCorner.obj","metalTileDouble.obj","metalTileLarge.obj","metalTileSmall.obj","meteorFull.obj","meteorFullRound.obj","meteorHalf.obj","pipeCorner.obj","pipeCornerDiagonal.obj","pipeOpening.obj","pipeRamp.obj","pipeSplit.obj","pipeStand.obj","pipeStandStraightLiner.obj","pipeStandStraightLinerEnd.obj","pipeStraight.obj","pipeStraightLiner.obj","portal.obj","robot.obj","rocks.obj","rocksOre.obj","rocksSmall.obj","rocksSmallOre.obj","rocksTall.obj","rocksTallOre.obj","satelliteDish.obj","satelliteDishAntenna.obj","satelliteDishLarge.obj","spaceCraft1.obj","spaceCraft2.obj","spaceCraft3.obj","spaceCraft4.obj","spaceCraft5.obj","spaceCraft6.obj","spaceCraftStand.obj","stairs.obj","stairsLong.obj","station.obj","stationLarge.obj"],watercraftpack_kenney:["watercraftPack_001.obj","watercraftPack_002.obj","watercraftPack_003.obj","watercraftPack_004.obj","watercraftPack_005.obj","watercraftPack_006.obj","watercraftPack_007.obj","watercraftPack_008.obj","watercraftPack_009.obj","watercraftPack_010.obj","watercraftPack_011.obj","watercraftPack_012.obj","watercraftPack_013.obj","watercraftPack_014.obj","watercraftPack_015.obj","watercraftPack_016.obj","watercraftPack_017.obj","watercraftPack_018.obj","watercraftPack_019.obj","watercraftPack_020.obj","watercraftPack_021.obj","watercraftPack_022.obj","watercraftPack_023.obj","watercraftPack_024.obj","watercraftPack_025.obj","watercraftPack_026.obj","watercraftPack_027.obj","watercraftPack_028.obj","watercraftPack_029.obj"],weaponpack_assets:["ammo_machinegun.obj","ammo_machinegunLauncher.obj","ammo_pistol.obj","ammo_rocket.obj","ammo_rocketModern.obj","ammo_shotgun.obj","ammo_sniper.obj","ammo_uzi.obj","flamethrower.obj","flamethrowerHandle.obj","grenade.obj","grenadeFlash.obj","grenadeSmoke.obj","grenade_vintage.obj","knifeRound_sharp.obj","knifeRound_smooth.obj","knife_sharp.obj","knife_smooth.obj","machinegun.obj","machinegunLauncher.obj","pistol.obj","pistolSilencer.obj","rocketlauncher.obj","rocketlauncherModern.obj","rocketlauncherModernRotating.obj","rocketlauncherSide.obj","shotgun.obj","shotgunShort.obj","sniper.obj","sniperCamo.obj","uzi.obj","uziGold.obj","uziGoldLong.obj","uziGoldLongSilencer.obj","uziGoldSilencer.obj","uziLong.obj","uziLongSilencer.obj","uziSilencer.obj"]}}open(e){let t=[];this.uiRenderer=document.getElementById("mainRenderer");for(let o=0;o<this.types[e].length;o++){let i=this.types[e][o].substr(0,this.types[e][o].length-4);t.push({name:this.types[e][o],friendly_name:i,image_url:"images/kenney/"+e+"/"+i+".jpg"})}this.context.content.compileTemplates("add-items",[{top_image_url:"images/kenney/"+e+"/Preview.png",items:t}],!0).then(e=>this.context.content.popup.setContent(e[0])).then(()=>{let t=this.context.content.popup.querySelectorAll(".type-select");for(let o=0;o<t.length;o++){let i=t[o];i.addEventListener("mousedown",()=>{this.context.popupBackStack.push(()=>this.open()),document.getElementById("backButton").setAttribute("scale","1 1 1");let t="models/prefabs/"+e+"/Models/"+i.dataset.key,o=t.substr(0,t.length-3)+"mtl",n=t.split("/");n.pop(),n=n.join("/")+"/",this.context.sceneGraph.add(this.context.currentObject,{type:"Custom",sub_type:"OBJ",url:t,mtl_url:o,mtl_path:n}).then(e=>{this.context.showObject(),this.context.displayBox.setObject(e.object3D),setTimeout(()=>this.context.itemView.open(e),250)}),this.uiRenderer.modal.close()})}})}}class f{constructor(e){this.context=e,this.types=[{name:"Food",friendly_name:"Food"},{name:"Hair",friendly_name:"Hair"},{name:"Hats",friendly_name:"Hats"},{name:"Masks-Mask1",friendly_name:"Masks-Mask1"},{name:"Masks-Mask2",friendly_name:"Masks-Mask2"},{name:"Masks-Mask3",friendly_name:"Masks-Mask3"},{name:"Masks-Mask4",friendly_name:"Masks-Mask4"},{name:"Masks-Mask5",friendly_name:"Masks-Mask5"},{name:"Masks-Mask6",friendly_name:"Masks-Mask6"},{name:"Masks-Mask7",friendly_name:"Masks-Mask7"},{name:"Masks-Mask8",friendly_name:"Masks-Mask8"},{name:"Weapons-pack1",friendly_name:"Weapons-pack1"},{name:"Weapons-pack2",friendly_name:"Weapons-pack2"},{name:"Weapons-pack3",friendly_name:"Weapons-pack3"},{name:"Weapons-pack4",friendly_name:"Weapons-pack4"},{name:"Weapons-pack5",friendly_name:"Weapons-pack5"}]}open(){this.context.content.compileTemplates("add-items",[{items:this.types}],!0).then(e=>this.context.content.popup.setContent(e[0])).then(()=>{let e=this.context.content.popup.querySelectorAll(".type-select");for(let t=0;t<e.length;t++){let o=e[t];o.addEventListener("mousedown",()=>{this.context.popupBackStack.push(()=>this.open()),document.getElementById("backButton").setAttribute("scale","1 1 1"),this.context.avatarModelsModal.open(o.dataset.key)})}})}}class w{constructor(e){this.context=e,this.maskTypes=["black-white","blood-moon","blue-blush","blue-white","copper","forest","white-orange"],this.types={Food:["Cake","Donuts","HamEgg","Hamburger","IceCream","Milk","Waffle"],Hair:["Hair1","Hair2","Hair3","Hair4","Hair5"],Hats:["BikeHelmet","BlueHelmet","BucketHat","ChristmasHat","ConeOfShame","DrinkingHat","FancyHat","FlopHat","FootballHelmet","FrenchPolicemanHat","GraduationHat","LadyHat","NavyParadeHat","PaperBag","PartyHat","PropellorHat","SailorsHat","SleepingHat","SoldierHelmet","SunHat","SweatBand","TrafficCone","UmbrellaHat","ValkyreHelmet","WeldingMask","WinterHat"],"Masks-Mask1":this.maskTypes,"Masks-Mask2":this.maskTypes,"Masks-Mask3":this.maskTypes,"Masks-Mask4":this.maskTypes,"Masks-Mask5":this.maskTypes,"Masks-Mask6":this.maskTypes,"Masks-Mask7":this.maskTypes,"Masks-Mask8":this.maskTypes,"Weapons-pack1":["arrow-explosive","arrow-piercing","arrow-regular","bomb","bow","crossbow","dagger","potion-berserk","potion-generic","potion-health","potion-mana","potion-stamina","shield","smoke-grenade","sulfur-grenade","sword"],"Weapons-pack2":["axe1","axe2","hammer","spear","sword1","sword2","sword3","sword4","sword5"],"Weapons-pack3":["angelblade","moonandstarblade","moonandstarsword","wingblade","wingsword"],"Weapons-pack4":["arrow","axe","bow","darksword","demonstaff","goldsword","naturestaff","shield","spiked-club","stonesword"],"Weapons-pack5":["ak47","barettm107","coltm4","gatling","handgun","rocket-shells","shotgun","smaw","uzi"]}}open(e){let t=[];for(let o=0;o<this.types[e].length;o++)t.push({name:this.types[e][o],friendly_name:this.types[e][o]});this.context.content.compileTemplates("add-items",[{items:t}],!0).then(e=>this.context.content.popup.setContent(e[0]))}}class T{constructor(e){this.context=e}title(e,t){return this.context.content.compileTemplates("title-section",[{name:e,uuid:t}],!0).then(e=>this.context.content.addTemplateItem("#titleSection",e[0]))}async stats(e){if(this.context.sceneGraph.canOpen()){let e=document.querySelector("#sceneStats");return void e.parentElement.removeChild(e)}let t={desktop:{points:0,pixels:0},mobile:{points:0,pixels:0}};this.context.sceneGraph.totals(e||this.context.sceneGraph.currentScene,t),await this.context.content.compileTemplates("object-stats",[t],!0).then(e=>this.context.content.addTemplateItem("#sceneStats",e[0]))}hideTransformOptions(){this.showTransformOptions(!0)}showTransformOptions(e){document.getElementById("positionButton").parentElement.setAttribute("visible",!e),document.getElementById("rotationButton").parentElement.setAttribute("visible",!e),document.getElementById("scaleButton").parentElement.setAttribute("visible",!e)}childObject(e){let t="images/icons/objects/",o={uuid:e.settings.uuid,image_url:t+"custom.jpg",name:e.settings.name,type:"Object3D"===e.settings.type?"Group":this.context.friendly_names.show(e.settings.type)};return"Object3D"===e.settings.type?o.image_url=t+"folder.jpg":"CustomGeometry"===e.settings.geometry.sub_type?o.image_url=e.settings.geometry.image||t+"parametric.jpg":"Custom"===e.settings.type?o.image_url=t+"custom.jpg":"Poly"===e.settings.type?o.image_url=t+"poly.jpg":"Parametric"===e.settings.type?o.image_url=t+"geometries/parametric/"+e.settings.geometry.sub_type.replace("Geometry","").replace("Buffer","").replace("Inverted","")+".jpg":"Primitive"===e.settings.type&&(o.image_url=t+"geometries/primitive/"+e.settings.geometry.type.replace("Geometry","").replace("Buffer","").replace("Inverted","")+".jpg"),o}setupNumberUpdate(e,t,o,i){let n=this.context.content.popup.querySelector(t).querySelector(".xInputUp"),a=this.context.content.popup.querySelector(t).querySelector(".xInputDown"),r=this.context.content.popup.querySelector(t).querySelector(".xText");n.addEventListener("mousedown",()=>{this.context.currentObject.settings[e][o]+=this.context.precision,this.context.currentObject.object3D[e][o]=i?THREE.Math.degToRad(this.context.currentObject.settings[e][o]):this.context.currentObject.settings[e][o],r.setAttribute("text","value:"+this.context.currentObject.settings[e][o].toFixed(3)),"geometry"===e&&(this.context.sceneGraph.objectFactory.resetGeometry(),this.context.displayBox.setObject(this.context.currentObject.object3D))}),a.addEventListener("mousedown",()=>{this.context.currentObject.settings[e][o]-=this.context.precision,this.context.currentObject.object3D[e][o]=this.context.currentObject.settings[e][o],r.setAttribute("text","value:"+this.context.currentObject.settings[e][o].toFixed(3)),"geometry"===e&&(this.context.sceneGraph.objectFactory.resetGeometry(),this.context.displayBox.setObject(this.context.currentObject.object3D))})}setupRadioInput(e,t){this.context.content.popup.querySelector(e).addEventListener("ui-radio-changed",e=>{t(e.detail)})}setupSwitcheInput(e,t,o){this.context.content.popup.querySelector(t).addEventListener("ui-switch-changed",t=>{this.context.currentObject.settings[e][o]=t.detail,this.context.currentObject.object3D[e][o]=this.context.currentObject.settings[e][o],"geometry"===e&&(this.context.sceneGraph.objectFactory.resetGeometry(),this.context.displayBox.setObject(this.context.currentObject.object3D))})}}class x{constructor(e){this.context=e,this.breadcrumbsContainer=document.getElementById("breadcrumbsContainer")}make(e){for(;this.breadcrumbsContainer.firstChild;)this.breadcrumbsContainer.removeChild(this.breadcrumbsContainer.firstChild);if(this.isOverloaded=e.length>=7,this.isOverloaded){let t=e.length-7;this.breadcrumbsContainer.appendChild(this.makeDivider(0,!0));for(let o=0;o<e.length;o++)e[o].isTop&&0===o&&(this.breadcrumbsContainer.appendChild(this.makeBreadCrumb(e[o],o)),this.breadcrumbsContainer.appendChild(this.makeDivider(o))),o>t&&(this.breadcrumbsContainer.appendChild(this.makeBreadCrumb(e[o],o-t)),this.breadcrumbsContainer.appendChild(this.makeDivider(o-t)))}else for(let t=0;t<e.length;t++)this.breadcrumbsContainer.appendChild(this.makeBreadCrumb(e[t],t)),this.breadcrumbsContainer.appendChild(this.makeDivider(t))}fromObject(e,t){return t=t||[],e.parent&&(t=t.concat(this.fromObject(e.parent))),t.push({name:e.parent?e.settings.name:this.context.sceneGraph.currentScene.metadata.name+" Scene",callback:()=>this.context.itemView.open(e),isTop:!e.parent}),t}makeBreadCrumb(e,t){let o=document.createElement("a-ui-button");return o.setAttribute("width",.45),o.setAttribute("height",.13),o.setAttribute("ripple-size","0.5 0.19"),o.setAttribute("position",(this.isOverloaded&&t>0?.52*t+.2:.52*t)+" 0 0"),o.setAttribute("wrap-count",13),o.setAttribute("text-value",this.shorten(e.name,14)),o.setAttribute("color","#42b8ac"),o.className="intersectable",o.addEventListener("mousedown",()=>{e.callback()}),o}makeDivider(e,t){let o=document.createElement("a-plane");return o.setAttribute("width",.12),o.setAttribute("position",(this.isOverloaded&&e&&!t>0?.52*e+.25+.2:.52*e+(t?.4:.25))+" 0 0"),o.setAttribute("height",.12),o.setAttribute("shader","flat"),o.setAttribute("transparent",!0),o.setAttribute("src",t?"#breadCrumbMore":"#breadCrumb"),o}shorten(e,t){return e.length>t?e.substr(0,t)+"...":e}}class v{constructor(e){this.context=e}open(){this.context.content.loadTemplates(["confirm-message"]).then(()=>this.context.content.compileTemplates("confirm-message",[{title:"Clear Scene",message:"Are you sure you want to remove all the items from this scene?",leftButtonText:"CANCEL",leftButtonFontColor:"#fff",leftButtonColor:"#009688",leftButtonRippleColor:"#fff",rightButtonText:"CLEAR SCENE",rightButtonFontColor:"#fff",rightButtonColor:"#e57373",rightButtonRippleColor:"#fff"}],!0)).then(e=>this.context.content.popup.setContent(e[0]))}}class k{constructor(e){this.context=e}open(){this.context.content.loadTemplates(["confirm-message"]).then(()=>this.context.content.compileTemplates("confirm-message",[{title:"Save Prefab",message:"Are you sure save this as a prefab object?",leftButtonText:"CANCEL",rightButtonText:"SAVE",middleButtonText:"SAVE & PUBLISH"}],!0)).then(e=>this.context.content.popup.setContent(e[0])).then(()=>{this.context.content.popup.querySelector(".close-modal").addEventListener("mousedown",()=>{console.log("prefab close")})})}}class E{constructor(e){this.context=e}open(){this.context.content.loadTemplates(["confirm-message"]).then(()=>this.context.content.compileTemplates("confirm-message",[{title:"Behaviours",message:"Select a behaviour to edit.",leftButtonText:"CANCEL",rightButtonText:"EDIT"}],!0)).then(e=>this.context.content.popup.setContent(e[0]))}}class S{constructor(e){this.context=e}open(){let e=this.context.currentObject.settings.material;console.log(e.type.substr(4,e.type.length-12)),this.context.content.loadTemplates(["object-type"]).then(()=>this.context.content.compileTemplates("object-type",[{type:"material",selected:e.type.substr(4,e.type.length-12),options:[{name:"Basic"},{name:"Standard"},{name:"Lambert"},{name:"Phong"},{name:"Depth"},{name:"Physical"},{name:"Toon"}]}],!0)).then(e=>this.context.content.popup.setContent(e[0])).then(()=>{let e=e=>{this.type="Mesh"+e.charAt(0).toUpperCase()+e.substr(1)+"Material"};this.context.viewUtils.setupRadioInput(".radio-basic",e),this.context.viewUtils.setupRadioInput(".radio-standard",e),this.context.viewUtils.setupRadioInput(".radio-lambert",e),this.context.viewUtils.setupRadioInput(".radio-phong",e),this.context.viewUtils.setupRadioInput(".radio-depth",e),this.context.viewUtils.setupRadioInput(".radio-physical",e),this.context.viewUtils.setupRadioInput(".radio-toon",e),this.context.content.popup.querySelector(".right-button").addEventListener("mousedown",()=>{this.context.sceneGraph.objectFactory.changeMaterial(this.type);let e=document.getElementById("materialSettings");e.querySelector(".doubleButton1").close();let t=this.context.currentObject.settings.material;e.querySelector(".titleContainer").setAttribute("value","Material Settings: "+t.type.substr(4,t.type.length-12))})})}}class M{constructor(e){this.context=e}open(){this.isPrimitive="Primitive"===this.context.currentObject.settings.type;let e=this.context.currentObject.settings.geometry[this.isPrimitive?"type":"sub_type"].replace("Geometry","").replace("Buffer","").replace("Inverted","");this.context.content.loadTemplates(["object-type"]).then(()=>this.context.content.compileTemplates("object-type",[{type:"geometry",selected:e,options:this.context[this.isPrimitive?"primitiveTypeModal":"parametricTypeModal"].types.filter(e=>-1===["My Fancys","Fancy Market","Create"].indexOf(e.friendly_name)).map(e=>({name:e.friendly_name}))}],!0)).then(e=>this.context.content.popup.setContent(e[0])).then(()=>{this.isPrimitive?this.setupPrimitiveChange():this.setupParametricChange()})}setupParametricChange(){let e=e=>{this.type=e.split(" ").join("")+"Geometry"};this.context.viewUtils.setupRadioInput(".radio-apple",e),this.context.viewUtils.setupRadioInput(".radio-appleinverted",e),this.context.viewUtils.setupRadioInput(".radio-fermat",e),this.context.viewUtils.setupRadioInput(".radio-spring",e),this.context.viewUtils.setupRadioInput(".radio-springinverted",e),this.context.viewUtils.setupRadioInput(".radio-helicoid",e),this.context.viewUtils.setupRadioInput(".radio-spiral",e),this.context.viewUtils.setupRadioInput(".radio-spiralinverted",e),this.context.viewUtils.setupRadioInput(".radio-pillow",e),this.context.viewUtils.setupRadioInput(".radio-pillowinverted",e),this.context.viewUtils.setupRadioInput(".radio-catenoid",e),this.context.viewUtils.setupRadioInput(".radio-scherk",e),this.context.viewUtils.setupRadioInput(".radio-klein",e),this.context.viewUtils.setupRadioInput(".radio-kleininverted",e),this.context.viewUtils.setupRadioInput(".radio-mobius",e),this.context.viewUtils.setupRadioInput(".radio-mobius3d",e),this.context.viewUtils.setupRadioInput(".radio-mobius3dinverted",e),this.context.viewUtils.setupRadioInput(".radio-snail",e),this.context.viewUtils.setupRadioInput(".radio-snailinverted",e),this.context.viewUtils.setupRadioInput(".radio-horn",e),this.context.viewUtils.setupRadioInput(".radio-horninverted",e),this.context.content.popup.querySelector(".right-button").addEventListener("mousedown",()=>{this.context.sceneGraph.objectFactory.changeGeometry(this.type),document.getElementById("geometrySettings").querySelector(".doubleButton1").close(),this.context.displayBox.setObject(this.context.currentObject.object3D)})}setupPrimitiveChange(){let e=e=>{this.type=e+"Geometry"};this.context.viewUtils.setupRadioInput(".radio-circle",e),this.context.viewUtils.setupRadioInput(".radio-cone",e),this.context.viewUtils.setupRadioInput(".radio-box",e),this.context.viewUtils.setupRadioInput(".radio-cylinder",e),this.context.viewUtils.setupRadioInput(".radio-dodecahedron",e),this.context.viewUtils.setupRadioInput(".radio-icosahedron",e),this.context.viewUtils.setupRadioInput(".radio-octahedron",e),this.context.viewUtils.setupRadioInput(".radio-plane",e),this.context.viewUtils.setupRadioInput(".radio-ring",e),this.context.viewUtils.setupRadioInput(".radio-sphere",e),this.context.viewUtils.setupRadioInput(".radio-tetrahedron",e),this.context.viewUtils.setupRadioInput(".radio-torus",e),this.context.viewUtils.setupRadioInput(".radio-torusknot",e),this.context.content.popup.querySelector(".right-button").addEventListener("mousedown",()=>{this.context.sceneGraph.objectFactory.changeGeometry(this.type);let e=document.getElementById("geometrySettings");e.querySelector(".doubleButton1").close(),e.querySelector(".titleContainer").setAttribute("value","Geometry Settings: "+this.context.currentObject.settings.geometry.type.replace("Geometry","").replace("Buffer","").replace("Inverted","")),this.context.displayBox.setObject(this.context.currentObject.object3D)})}}class P{constructor(e){this.context=e}preload(){let e=document.getElementById("loadingText"),t=document.getElementById("loadingTextBack"),o=(new Date).getTime(),i=["scene-item","add-items","title-section","three-number-inputs","object-stats","mobile-response","single-item-button","double-item-button","side-item-add","radios","switches","color","color-intensity","number","map-settings","confirm-message","double-item-button","mobile-response","object-stats","object-type","side-item-add","single-item-button","three-number-inputs","title-section","material-options"].map(e=>this.context.content.loadTemplates([e])),n=0,a=i.length;t.setAttribute("scale","1 1 1");for(let r=0;r<a;r++){i[r].then(()=>{let i=++n/a;e.setAttribute("value",Math.round(100*i)+"%"),1===i&&(console.log("Templates loaded in: "+((new Date).getTime()-o)/1e3+"s"),setTimeout(()=>{e.setAttribute("value",""),t.setAttribute("scale","0 0 0")},500))})}return Promise.all(i)}}class C{constructor(e){this.context=e}open(){switch(this.material=this.context.currentObject.settings.material,this.type=this.material.type.substr(4,this.material.type.length-12).toLowerCase(),this.resetTemplate(),this.type){case"basic":return this.openBasic();case"standard":return this.openStandard();case"lambert":return this.openLambert();case"phong":return this.openPhong();case"depth":return this.openBasic();case"physical":return this.openStandard(!0);case"toon":return this.openPhong(!0)}}async load(){return this.startSection='\n            <a-text font="roboto" baseLine="top" anchor="center" \n            value="'+this.type.charAt(0).toUpperCase()+this.type.substr(1)+' Material Settings"\n                    color="#212121" wrap-count="26" width="1.35" height="0.15"></a-text>\n            <a-plane width="2.9" height="0.01" color="#8f8f8f" shader="flat"></a-plane>\n            <a-entity width="1.35">',this.midSection='\n            </a-entity>\n            <a-plane width="0.01" height="1.6" color="#8f8f8f" shader="flat"></a-plane>\n            <a-entity width="1.35">',this.endSection="</a-entity>",this.context.content.loadTemplates(["radios","switches","color","color-intensity","number","map-settings"])}async openBasic(){return this.load().then(()=>{this.templates.switches.push({settings:[{name:"Wireframe",selected:this.material.wireframe}]},{settings:[{name:"Fog",selected:this.material.fog}]},{settings:[{name:"Lights",selected:this.material.lights}]}),this.templates.color.push({color:this.material.color}),this.templates.mapSettings.push({}),this.templates.number.push({name:"Refraction Ratio",number:this.material.refractionRatio})}).then(()=>this.compile()).then(e=>{let t=this.buildDefaults(e),o=e[3].shift(),i=e[4].shift(),n=e[2].shift(),a=e[0].shift(),r=o+i+n+e[0].shift()+e[0].shift()+a,s=this.startSection+r+this.midSection+t+this.endSection;return this.context.content.popup.setContent(s)}).then(()=>{this.setupColorUpdate(".colorInputField","color"),this.context.viewUtils.setupNumberUpdate("material",".refractionratio","refractionRatio"),this.context.viewUtils.setupSwitcheInput("material",".switch-fog","fog"),this.context.viewUtils.setupSwitcheInput("material",".switch-lights","lights"),this.setupDefaultUpdate()})}async openStandard(e){return this.load().then(()=>{this.templates.switches.push({settings:[{name:"Wireframe",selected:this.material.wireframe}]}),this.templates.color.push({color:this.material.color}),this.templates.colorIntensity.push({name:"Emissiveness",color:this.material.emissive,intensity:this.material.emissiveIntensity}),this.templates.mapSettings.push({}),this.templates.number.push({name:"Metalness",number:this.material.metalness},{name:"Roughness",number:this.material.roughness},{name:"Refraction Ratio",number:this.material.refractionRatio}),e&&this.templates.number.push({name:"Clear Coat",number:this.material.clearCoat},{name:"Clear Coat Roughness",number:this.material.clearCoatRoughness},{name:"Reflectivity",number:this.material.reflectivity})}).then(()=>this.compile()).then(t=>{let o=this.buildDefaults(t),i=t[3].shift(),n=t[5].shift(),a=t[4].shift(),r=t[2].shift(),s=t[2].shift(),l=t[2].shift(),c="";e&&(c+=t[2].shift(),c+=t[2].shift(),c+=t[2].shift());let h=i+n+a+r+s+c+l+t[0].shift(),u=this.startSection+h+this.midSection+o+this.endSection;return this.context.content.popup.setContent(u)}).then(()=>{this.setupColorUpdate(".colorInputField","color"),this.setupEmissiveUpdate(),this.context.viewUtils.setupNumberUpdate("material",".metalness","metalness"),this.context.viewUtils.setupNumberUpdate("material",".opacity","opacity"),this.context.viewUtils.setupNumberUpdate("material",".alphatest","alphaTest"),this.context.viewUtils.setupNumberUpdate("material",".refractionratio","refractionRatio"),this.context.viewUtils.setupNumberUpdate("material",".roughness","roughness"),e&&(this.context.viewUtils.setupNumberUpdate("material",".clearcoat","clearCoat"),this.context.viewUtils.setupNumberUpdate("material",".clearcoatroughness","clearCoatRoughness"),this.context.viewUtils.setupNumberUpdate("material",".reflectivity","reflectivity")),this.setupDefaultUpdate()})}setupDefaultUpdate(){this.context.viewUtils.setupNumberUpdate("material",".opacity","opacity"),this.context.viewUtils.setupSwitcheInput("material",".switch-wireframe","wireframe"),this.context.viewUtils.setupSwitcheInput("material",".switch-visible","visible"),this.context.viewUtils.setupSwitcheInput("material",".switch-transparent","transparent");let e=e=>{this.material.side="Front"===e?THREE.FrontSide:"Back"===e?THREE.BackSide:THREE.DoubleSide,this.context.currentObject.object3D.material.side=this.material.side};this.context.viewUtils.setupRadioInput(".radio-front",e),this.context.viewUtils.setupRadioInput(".radio-back",e),this.context.viewUtils.setupRadioInput(".radio-double",e)}setupColorUpdate(e,t){let o=this.context.content.popup.querySelector(e),i=this.context.content.popup.querySelector(e+"Text");o.addEventListener("mousedown",()=>{document.getElementById("colorPicker").open().then(e=>{i.setAttribute("value",e),o.setAttribute("color",e),this.context.currentObject.settings.material[t]=e,this.context.currentObject.object3D.material[t]=new THREE.Color(e)})})}setupEmissiveUpdate(){this.setupColorUpdate(".colorIntensityInput","emissive"),this.context.viewUtils.setupNumberUpdate("material",".emissiveness","emissiveIntensity")}async openPhong(){return this.load().then(()=>{this.templates.switches.push({settings:[{name:"Wireframe",selected:this.material.wireframe}]}),this.templates.color.push({color:this.material.color},{color:this.material.color,colorName:"Specular",colorButtonClass:"specularInput",colorButtonTextClass:"specularInputText"}),this.templates.colorIntensity.push({name:"Emissiveness",color:this.material.emissive,intensity:this.material.emissiveIntensity}),this.templates.mapSettings.push({}),this.templates.number.push({name:"Reflectivity",number:this.material.reflectivity},{name:"Refraction Ratio",number:this.material.refractionRatio},{name:"Shininess",number:this.material.shininess})}).then(()=>this.compile()).then(e=>{let t=this.buildDefaults(e),o=e[3].shift(),i=e[5].shift(),n=e[4].shift(),a=e[2].shift(),r=e[2].shift(),s=o+i+n+e[2].shift()+e[3].shift()+a+r+e[0].shift(),l=this.startSection+s+this.midSection+t+this.endSection;return this.context.content.popup.setContent(l)}).then(()=>{this.setupColorUpdate(".colorInputField","color"),this.setupColorUpdate(".specularInput","specular"),this.setupEmissiveUpdate(),this.context.viewUtils.setupNumberUpdate("material",".reflectivity","reflectivity"),this.context.viewUtils.setupNumberUpdate("material",".refractionratio","refractionRatio"),this.context.viewUtils.setupNumberUpdate("material",".shininess","shininess"),this.setupDefaultUpdate()})}async openLambert(){return this.load().then(()=>{this.templates.switches.push({settings:[{name:"Wireframe",selected:this.material.wireframe}]}),this.templates.color.push({color:this.material.color}),this.templates.colorIntensity.push({name:"Emissiveness",color:this.material.emissive,intensity:this.material.emissiveIntensity}),this.templates.mapSettings.push({}),this.templates.number.push({name:"Reflectivity",number:this.material.reflectivity},{name:"Refraction Ratio",number:this.material.refractionRatio})}).then(()=>this.compile()).then(e=>{let t=this.buildDefaults(e),o=e[3].shift()+e[5].shift()+e[4].shift()+e[2].shift()+e[2].shift()+e[0].shift(),i=this.startSection+o+this.midSection+t+this.endSection;return this.context.content.popup.setContent(i)}).then(()=>{this.setupColorUpdate(".colorInputField","color"),this.setupEmissiveUpdate(),this.context.viewUtils.setupNumberUpdate("material",".reflectivity","reflectivity"),this.context.viewUtils.setupNumberUpdate("material",".refractionratio","refractionRatio"),this.setupDefaultUpdate()})}async compile(){let e=[this.context.content.compileTemplates("switches",this.templates.switches),this.context.content.compileTemplates("radios",this.templates.radios),this.context.content.compileTemplates("number",this.templates.number)];return this.templates.color.length&&e.push(this.context.content.compileTemplates("color",this.templates.color)),this.templates.colorIntensity.length&&e.push(this.context.content.compileTemplates("color-intensity",this.templates.colorIntensity)),this.templates.mapSettings.length&&e.push(this.context.content.compileTemplates("map-settings",this.templates.mapSettings)),Promise.all(e)}buildDefaults(e){return e[1].shift()+e[0].shift()+e[2].shift()+e[2].shift()}resetTemplate(){let e=this.material.side===THREE.FrontSide?"Front":this.material.side===THREE.BackSide?"Back":"Double";this.templates={switches:[{settings:[{name:"Visible",selected:this.material.visible},{name:"Transparent",selected:this.material.transparent}]}],radios:[{name:"Side",selected:e,settings:[{name:"Front"},{name:"Back"},{name:"Double"}]}],number:[{name:"Opacity",number:this.material.opacity},{name:"Alpha Test",number:this.material.alphaTest}],color:[],colorIntensity:[],mapSettings:[]}}}class R{constructor(e){this.context=e}open(){switch(this.isPrimitive="Primitive"===this.context.currentObject.settings.type,this.geometry=this.context.currentObject.settings.geometry,this.type=this.isPrimitive?this.geometry.type.replace("Geometry","").replace("Buffer","").replace("Inverted","").toLowerCase():"parametric",this.resetTemplate(),this.type){case"box":return this.openBox();case"circle":return this.openCircle();case"cone":return this.openCone();case"cylinder":return this.openCylinder();case"dodecahedron":case"icosahedron":case"octahedron":case"tetrahedron":return this.openHedron();case"plane":return this.openPlane();case"ring":return this.openRing();case"sphere":return this.openSphere();case"torus":return this.openTorus();case"torusknot":return this.openTorusKnot();case"parametric":return this.openParametric()}}async load(){return this.startSection='\n            <a-text font="roboto" baseLine="top" anchor="center" \n            value="'+this.type.charAt(0).toUpperCase()+this.type.substr(1)+' Geometry Settings"\n                    color="#212121" wrap-count="26" width="1.35" height="0.15"></a-text>\n            <a-plane width="2.9" height="0.01" color="#8f8f8f" shader="flat"></a-plane>\n            <a-entity width="1.35">',this.midSection='\n            </a-entity>\n            <a-plane width="0.01" height="1.6" color="#8f8f8f" shader="flat"></a-plane>\n            <a-entity width="1.35">',this.endSection="</a-entity>",this.context.content.loadTemplates(["radios","switches","number"])}openSphere(){return this.load().then(()=>{this.templates.number.push({name:"Radius",number:this.geometry.radius},{name:"Width Segments",number:this.geometry.widthSegments},{name:"Height Segments",number:this.geometry.heightSegments},{name:"Phi Start",number:THREE.Math.radToDeg(this.geometry.phiStart)},{name:"Phi Length",number:THREE.Math.radToDeg(this.geometry.phiLength)},{name:"Theta Start",number:THREE.Math.radToDeg(this.geometry.thetaStart)},{name:"Theta Length",number:THREE.Math.radToDeg(this.geometry.thetaLength)})}).then(()=>this.compile()).then(e=>{let t=e[0].shift(),o=e[0].shift(),i=e[0].shift(),n=e[0].shift(),a=e[0].shift(),r=e[0].shift(),s=e[0].shift(),l=t+o+i+n+a+this.midSection+r+s,c=this.startSection+l+this.endSection;return this.context.content.popup.components["ui-scroll-pane"].setContent(c)}).then(()=>{this.context.viewUtils.setupNumberUpdate("geometry",".radius","radius"),this.context.viewUtils.setupNumberUpdate("geometry",".widthsegments","widthSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".heightsegments","heightSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".phistart","phiStart"),this.context.viewUtils.setupNumberUpdate("geometry",".philength","phiLength",!0),this.context.viewUtils.setupNumberUpdate("geometry",".thetastart","thetaStart",!0)})}openTorus(){return this.load().then(()=>{this.templates.number.push({name:"Tube",number:this.geometry.tube},{name:"Radial Segments",number:this.geometry.radialSegments},{name:"Tubular Segments",number:this.geometry.tubularSegments},{name:"Arc",number:THREE.Math.radToDeg(this.geometry.arc)})}).then(()=>this.compile()).then(e=>{let t=e[0].shift(),o=e[0].shift(),i=e[0].shift(),n=t+e[0].shift()+this.midSection+o+i,a=this.startSection+n+this.endSection;return this.context.content.popup.components["ui-scroll-pane"].setContent(a)}).then(()=>{this.context.viewUtils.setupNumberUpdate("geometry",".tube","tube"),this.context.viewUtils.setupNumberUpdate("geometry",".radialsegments","radialSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".tubularsegments","tubularSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".arc","arc")})}openTorusKnot(){return this.load().then(()=>{this.templates.number.push({name:"Tube",number:this.geometry.tube},{name:"Radial Segments",number:this.geometry.radialSegments},{name:"Tubular Segments",number:this.geometry.tubularSegments},{name:"Arc",number:THREE.Math.radToDeg(this.geometry.arc)},{name:"P",number:this.geometry.p},{name:"Q",number:this.geometry.q})}).then(()=>this.compile()).then(e=>{let t=e[0].shift(),o=e[0].shift(),i=e[0].shift(),n=t+e[0].shift()+e[0].shift()+e[0].shift()+this.midSection+o+i,a=this.startSection+n+this.endSection;return this.context.content.popup.components["ui-scroll-pane"].setContent(a)}).then(()=>{this.context.viewUtils.setupNumberUpdate("geometry",".tube","tube"),this.context.viewUtils.setupNumberUpdate("geometry",".radialsegments","radialSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".tubularsegments","tubularSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".p","p"),this.context.viewUtils.setupNumberUpdate("geometry",".q","q")})}openParametric(){return this.load().then(()=>{this.templates.number.push({name:"Slices",number:this.geometry.slices},{name:"Stacks",number:this.geometry.stacks})}).then(()=>this.compile()).then(e=>{let t=e[0].shift()+e[0].shift()+this.midSection,o=this.startSection+t+this.endSection;return this.context.content.popup.components["ui-scroll-pane"].setContent(o)}).then(()=>{this.context.viewUtils.setupNumberUpdate("geometry",".slices","slices"),this.context.viewUtils.setupNumberUpdate("geometry",".stacks","stacks")})}openRing(){return this.load().then(()=>{this.templates.number.push({name:"Inner Radius",number:this.geometry.innerRadius},{name:"Outer Radius",number:this.geometry.outerRadius},{name:"Theta Segments",number:this.geometry.thetaSegments},{name:"Phi Segments",number:this.geometry.phiSegments},{name:"Theta Start",number:THREE.Math.radToDeg(this.geometry.thetaStart)},{name:"Theta Length",number:THREE.Math.radToDeg(this.geometry.thetaLength)})}).then(()=>this.compile()).then(e=>{let t=e[0].shift(),o=e[0].shift(),i=e[0].shift(),n=e[0].shift(),a=e[0].shift(),r=e[0].shift(),s=t+o+i+n+this.midSection+a+r,l=this.startSection+s+this.endSection;return this.context.content.popup.components["ui-scroll-pane"].setContent(l)}).then(()=>{this.context.viewUtils.setupNumberUpdate("geometry",".innerradius","innerRadius"),this.context.viewUtils.setupNumberUpdate("geometry",".outerradius","outerRadius"),this.context.viewUtils.setupNumberUpdate("geometry",".thetasegments","thetaSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".phisegments","phiSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".thetastart","thetaStart",!0),this.context.viewUtils.setupNumberUpdate("geometry",".thetalength","thetaLength",!0)})}openPlane(){return this.load().then(()=>{this.templates.number.push({name:"Width",number:this.geometry.width},{name:"Height",number:this.geometry.height},{name:"Width Segments",number:this.geometry.widthSegments},{name:"Height Segments",number:this.geometry.heightSegments})}).then(()=>this.compile()).then(e=>{let t=e[0].shift(),o=e[0].shift(),i=e[0].shift(),n=e[0].shift(),a=t+o+this.midSection+i+n,r=this.startSection+a+this.endSection;return this.context.content.popup.components["ui-scroll-pane"].setContent(r)}).then(()=>{this.context.viewUtils.setupNumberUpdate("geometry",".width","width"),this.context.viewUtils.setupNumberUpdate("geometry",".height","height"),this.context.viewUtils.setupNumberUpdate("geometry",".widthsegments","widthSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".heightsegments","heightSegments")})}openHedron(){return this.load().then(()=>{this.templates.number.push({name:"Radius",number:this.geometry.radius},{name:"Detail",number:this.geometry.detail})}).then(()=>this.compile()).then(e=>{let t=e[0].shift()+e[0].shift()+this.midSection,o=this.startSection+t+this.endSection;return this.context.content.popup.components["ui-scroll-pane"].setContent(o)}).then(()=>{this.context.viewUtils.setupNumberUpdate("geometry",".radius","radius"),this.context.viewUtils.setupNumberUpdate("geometry",".detail","detail")})}openCylinder(){return this.load().then(()=>{this.templates.switches.push({settings:[{name:"Open Ended",selected:this.geometry.openEnded}]}),this.templates.number.push({name:"Radius Top",number:this.geometry.radiusTop},{name:"Radius Bottom",number:this.geometry.radiusBottom},{name:"Height",number:this.geometry.height},{name:"Radial Segments",number:this.geometry.radialSegments},{name:"Height Segments",number:this.geometry.heightSegments},{name:"Theta Start",number:THREE.Math.radToDeg(this.geometry.thetaStart)},{name:"Theta Length",number:THREE.Math.radToDeg(this.geometry.thetaLength)})}).then(()=>this.compile()).then(e=>{let t=e[1].shift(),o=e[1].shift(),i=e[1].shift(),n=e[1].shift(),a=e[1].shift(),r=e[1].shift(),s=e[1].shift(),l=e[0].shift(),c=t+o+i+r+s+this.midSection+n+a+l,h=this.startSection+c+this.endSection;return this.context.content.popup.components["ui-scroll-pane"].setContent(h)}).then(()=>{this.context.viewUtils.setupNumberUpdate("geometry",".radiustop","radiusTop"),this.context.viewUtils.setupNumberUpdate("geometry",".radiusbottom","radiusBottom"),this.context.viewUtils.setupNumberUpdate("geometry",".radialsegments","radialSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".heightsegments","heightSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".thetastart","thetaStart",!0),this.context.viewUtils.setupNumberUpdate("geometry",".thetalength","thetaLength",!0),this.context.viewUtils.setupSwitcheInput("geometry",".switch-openended","openEnded")})}openCone(){return this.load().then(()=>{this.templates.switches.push({settings:[{name:"Open Ended",selected:this.geometry.openEnded}]}),this.templates.number.push({name:"Radius",number:this.geometry.radius},{name:"Height",number:this.geometry.height},{name:"Radial Segments",number:this.geometry.radialSegments},{name:"Height Segments",number:this.geometry.heightSegments},{name:"Theta Start",number:THREE.Math.radToDeg(this.geometry.thetaStart)},{name:"Theta Length",number:THREE.Math.radToDeg(this.geometry.thetaLength)})}).then(()=>this.compile()).then(e=>{let t=e[1].shift(),o=e[1].shift(),i=e[1].shift(),n=e[1].shift(),a=e[1].shift(),r=e[1].shift(),s=e[0].shift(),l=t+o+a+r+this.midSection+i+n+s,c=this.startSection+l+this.endSection;return this.context.content.popup.components["ui-scroll-pane"].setContent(c)}).then(()=>{this.context.viewUtils.setupNumberUpdate("geometry",".radius","radius"),this.context.viewUtils.setupNumberUpdate("geometry",".height","height"),this.context.viewUtils.setupNumberUpdate("geometry",".radialsegments","radialSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".heightsegments","heightSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".thetastart","thetaStart",!0),this.context.viewUtils.setupNumberUpdate("geometry",".thetalength","thetaLength",!0),this.context.viewUtils.setupSwitcheInput("geometry",".switch-openended","openEnded")})}openCircle(){return this.load().then(()=>{this.templates.number.push({name:"Radius",number:this.geometry.radius},{name:"Segments",number:this.geometry.segments},{name:"Theta Start",number:THREE.Math.radToDeg(this.geometry.thetaStart)},{name:"Theta Length",number:THREE.Math.radToDeg(this.geometry.thetaLength)})}).then(()=>this.compile()).then(e=>{let t=e[0].shift(),o=e[0].shift(),i=e[0].shift(),n=e[0].shift(),a=t+o+this.midSection+i+n,r=this.startSection+a+this.endSection;return this.context.content.popup.components["ui-scroll-pane"].setContent(r)}).then(()=>{this.context.viewUtils.setupNumberUpdate("geometry",".radius","radius"),this.context.viewUtils.setupNumberUpdate("geometry",".segments","segments"),this.context.viewUtils.setupNumberUpdate("geometry",".thetastart","thetaStart",!0),this.context.viewUtils.setupNumberUpdate("geometry",".thetalength","thetaLength",!0)})}openBox(){return this.load().then(()=>{this.templates.number.push({name:"Width",number:this.geometry.width},{name:"Height",number:this.geometry.height},{name:"Depth",number:this.geometry.depth},{name:"Width Segments",number:this.geometry.widthSegments},{name:"Height Segments",number:this.geometry.heightSegments},{name:"Depth Segments",number:this.geometry.depthSegments})}).then(()=>this.compile()).then(e=>{let t=e[0].shift(),o=e[0].shift(),i=e[0].shift(),n=e[0].shift(),a=e[0].shift(),r=e[0].shift(),s=t+o+i+this.midSection+n+a+r,l=this.startSection+s+this.endSection;return this.context.content.popup.components["ui-scroll-pane"].setContent(l)}).then(()=>{this.context.viewUtils.setupNumberUpdate("geometry",".width","width"),this.context.viewUtils.setupNumberUpdate("geometry",".height","height"),this.context.viewUtils.setupNumberUpdate("geometry",".depth","depth"),this.context.viewUtils.setupNumberUpdate("geometry",".widthsegments","widthSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".heightsegments","heightSegments"),this.context.viewUtils.setupNumberUpdate("geometry",".depthsegments","depthSegments")})}async compile(){let e=[];return this.templates.switches.length&&e.push(this.context.content.compileTemplates("switches",this.templates.switches)),this.templates.radios.length&&e.push(this.context.content.compileTemplates("radios",this.templates.radios)),this.templates.number.length&&e.push(this.context.content.compileTemplates("number",this.templates.number)),Promise.all(e)}resetTemplate(){this.templates={switches:[],radios:[],number:[]}}}class B{constructor(e){this.context=e,this.startSection='\n            <a-text font="roboto" baseLine="top" anchor="center" \n            value="Object Transform Settings"\n                    color="#212121" wrap-count="26" width="1.35" height="0.15"></a-text>\n            <a-plane width="2.9" height="0.01" color="#8f8f8f" shader="flat"></a-plane>\n            <a-entity width="2.9">',this.endSection="</a-entity>"}open(){let e=this.context.currentObject,t=e.settings.transform.rotation;this.context.content.compileTemplates("three-number-inputs",[{name:"Position",vector:e.settings.transform.position,className:"positionSettings"},{name:"Rotation",vector:{x:THREE.Math.radToDeg(t.x),y:THREE.Math.radToDeg(t.y),z:THREE.Math.radToDeg(t.z)},className:"rotationSettings"},{name:"Scale",vector:e.settings.transform.scale,className:"scaleSettings"}]).then(e=>{this.context.content.popup.setContent(this.startSection+e[0]+e[1]+e[2]+this.endSection),this.setupTransformListeners(),this.setupTransformButtons()})}setupTransformButtons(){let e=document.querySelector(".positionSettings"),t=document.querySelector(".rotationSettings"),o=document.querySelector(".scaleSettings");this.setupTransformButtonGroup(e,"position"),this.setupTransformButtonGroup(t,"rotation"),this.setupTransformButtonGroup(o,"scale")}setupTransformButtonGroup(e,t){this.setupTransformButton(e,".xInputUp","x",1,t),this.setupTransformButton(e,".xInputDown","x",-1,t),this.setupTransformButton(e,".yInputUp","y",1,t),this.setupTransformButton(e,".yInputDown","y",-1,t),this.setupTransformButton(e,".zInputUp","z",1,t),this.setupTransformButton(e,".zInputDown","z",-1,t),e.querySelector(".reset-values").addEventListener("mousedown",()=>{let e=0;"scale"===t&&(e=1),this.context.currentObject.settings.transform[t]={x:e,y:e,z:e},this.context.currentObject.object3D[t].set(e,e,e),this.context.transformUpdate(),this.context.displayBox.setObject(this.context.currentObject.object3D)})}setupTransformButton(e,t,o,i,n){e.querySelector(t).addEventListener("mousedown",()=>{let e=this.context.precision*i;"rotation"===n&&(e=THREE.Math.degToRad(e)),this.context.currentObject.settings.transform[n][o]+=e,this.context.currentObject.object3D[n][o]+=e,this.context.transformUpdate(),this.context.displayBox.setObject(this.context.currentObject.object3D)})}setupTransformListeners(){let e=document.querySelector(".positionSettings"),t=document.querySelector(".rotationSettings"),o=document.querySelector(".scaleSettings"),i=";color:#212121;wrapCount:12;align:center";this.context.transformUpdate=(()=>{UI.utils.isChanging(this.context.sceneEl,this.context.currentObject.settings.uuid);let n=this.context.currentObject.settings.transform.position,a=this.context.currentObject.settings.transform.rotation,r=this.context.currentObject.settings.transform.scale;e.querySelector(".xInput").setAttribute("text","value:"+n.x.toFixed(3)+i),e.querySelector(".yInput").setAttribute("text","value:"+n.y.toFixed(3)+i),e.querySelector(".zInput").setAttribute("text","value:"+n.z.toFixed(3)+i),t.querySelector(".xInput").setAttribute("text","value:"+THREE.Math.radToDeg(a.x).toFixed(3)+i),t.querySelector(".yInput").setAttribute("text","value:"+THREE.Math.radToDeg(a.y).toFixed(3)+i),t.querySelector(".zInput").setAttribute("text","value:"+THREE.Math.radToDeg(a.z).toFixed(3)+i),o.querySelector(".xInput").setAttribute("text","value:"+r.x.toFixed(3)+i),o.querySelector(".yInput").setAttribute("text","value:"+r.y.toFixed(3)+i),o.querySelector(".zInput").setAttribute("text","value:"+r.z.toFixed(3)+i),UI.utils.stoppedChanging(this.context.currentObject.settings.uuid)})}}class I{constructor(e){this.context=e}open(e){this.context.content.loadTemplates(["material-options"]).then(()=>this.context.content.compileTemplates("material-options",[{selected:"Standard",options:[{name:"Basic"},{name:"Standard"},{name:"Lambert"},{name:"Phong"},{name:"Depth"},{name:"Physical"},{name:"Toon"}]}])).then(e=>{this.context.content.popup.setContent(e[0])}).then(()=>{this.uiRenderer=document.getElementById("mainRenderer"),this.type="MeshStandardMaterial",this.color="#ffffff";let t=e=>{this.type="Mesh"+e.charAt(0).toUpperCase()+e.substr(1)+"Material"};this.context.viewUtils.setupRadioInput(".radio-basic",t),this.context.viewUtils.setupRadioInput(".radio-standard",t),this.context.viewUtils.setupRadioInput(".radio-lambert",t),this.context.viewUtils.setupRadioInput(".radio-phong",t),this.context.viewUtils.setupRadioInput(".radio-depth",t),this.context.viewUtils.setupRadioInput(".radio-physical",t),this.context.viewUtils.setupRadioInput(".radio-toon",t),this.setupColorUpdate(".colorInputField"),this.context.content.popup.querySelector(".left-button").addEventListener("mousedown",()=>{this.uiRenderer.modal.close()}),this.context.content.popup.querySelector(".right-button").addEventListener("mousedown",()=>{this.uiRenderer.modal.close(),e.mat_settings={type:this.type,color:this.color},this.context.sceneGraph.add(this.context.currentObject,e).then(e=>{this.context.showObject(),this.context.displayBox.setObject(e.object3D),setTimeout(()=>this.context.itemView.open(e),250)}),this.uiRenderer.modal.close()})})}setupColorUpdate(e){let t=this.context.content.popup.querySelector(e),o=this.context.content.popup.querySelector(e+"Text");t.addEventListener("mousedown",()=>{document.getElementById("colorPicker").open().then(e=>{o.setAttribute("value",e),t.setAttribute("color",e),this.color=e})})}}document.addEventListener("DOMContentLoaded",()=>{window.main=new class{constructor(){this.session=new r(this),this.content=new a(this),this.friendly_names=new d,this.namer=new u.a,this.sceneGraph=new s.a(this),this.breadCrumbs=new x(this),this.setupViews(),this.setupModals(),this.editor=document.getElementById("editorContainer"),this.sceneEl=document.querySelector("a-scene"),this.sceneEl.addEventListener("modal-closed",()=>{this.content.popup.components["ui-scroll-pane"].setContent("")});let e=document.getElementById("loadingText"),t=document.getElementById("loadingTextBack"),o=0;this.sceneEl.addEventListener("scene-load-start",()=>{o=(new Date).getTime(),t.setAttribute("scale","1 1 1")}),this.sceneEl.addEventListener("scene-loading",i=>{e.setAttribute("value",Math.round(100*i.detail)+"%"),1===i.detail&&(console.log("Scene loaded in: "+((new Date).getTime()-o)/1e3+"s"),setTimeout(()=>{e.setAttribute("value",""),t.setAttribute("scale","0 0 0")},500))}),new P(this).preload(),this.sceneEl.context=this,this.sceneList.open(),this.setupTopMenu(),this.setupPopupNavigation(),this.setupTransformOptions(),this.showAlphaMap=(new THREE.TextureLoader).load("images/nav-alpha.jpg"),this.hideAlphaMap=(new THREE.TextureLoader).load("images/nav-alpha-hide.jpg"),this.showMaterial=document.getElementById("uiPanel").getObject3D("mesh").material,this.showMaterial.transparent=!0,this.showMaterial.alphaMap=this.hideAlphaMap,this.displayBox=document.getElementById("displayBox").components["display-box"],this.displayBox.hide(),this.sceneEl.addEventListener("transform-update",()=>{this.transformUpdate&&this.transformUpdate()}),document.getElementById("topTitle").addEventListener("mousedown",()=>{this.itemView.open()}),this.precision=1;let i=document.getElementById("precisionButton");i.addEventListener("mousedown",()=>{this.precision/=10,this.precision<.001&&(this.precision=100),i.components["ui-toast"].data.toastEl.setAttribute("text-value","Precision: "+this.precision)});let n=document.getElementById("popupPrecision");n.addEventListener("mousedown",()=>{this.precision/=10,this.precision<.001&&(this.precision=100),n.components["ui-toast"].data.toastEl.setAttribute("text-value","Precision: "+this.precision)}),this.cameraDummy=document.getElementById("cameraDummyPosition"),document.getElementById("menuButton").addEventListener("click",()=>this.openEditor()),document.getElementById("closeEditor").addEventListener("mousedown",()=>this.closeEditor())}setupPopupNavigation(){document.getElementById("backButton").addEventListener("mousedown",()=>this.popupBack()),document.getElementById("closePopup").addEventListener("mousedown",()=>this.popupBackStack.length=0),this.popupBackStack=[]}popupBack(){let e=this.popupBackStack.pop();e&&e()}setupViews(){this.sceneList=new l(this),this.itemView=new c(this),this.popupView=new h(this),this.viewUtils=new T(this)}setupModals(){this.objectTypeModal=new m(this),this.primitiveTypeModal=new p(this),this.parametricTypeModal=new b(this),this.lightTypeModal=new g(this),this.prefabOptionModal=new j(this),this.kennyCategories=new _(this),this.kennyModelsModal=new y(this),this.avatarCategories=new f(this),this.avatarModelsModal=new w(this),this.clearSceneModal=new v(this),this.savePrefabModal=new k(this),this.behavioursModal=new E(this),this.transformModal=new B(this),this.materialTypeModal=new S(this),this.materialSettingsModal=new C(this),this.geometryTypeModal=new M(this),this.geometrySettingsModal=new R(this),this.objectMaterial=new I(this)}setupTransformOptions(){let e=document.getElementById("gizmos");document.getElementById("positionButton").addEventListener("mousedown",()=>{e.setAttribute("gizmo","mode:position")}),document.getElementById("rotationButton").addEventListener("mousedown",()=>{e.setAttribute("gizmo","mode:rotation")}),document.getElementById("scaleButton").addEventListener("mousedown",()=>{e.setAttribute("gizmo","mode:scale")})}showObject(){this.showMaterial.alphaMap=this.showAlphaMap,this.showMaterial.alphaMap.needsUpdate=!0,setTimeout(()=>{this.showMaterial.alphaMap=this.hideAlphaMap,this.showMaterial.alphaMap.needsUpdate=!0},2500)}setupTopMenu(){}closeEditor(){let e=this;new TWEEN.Tween({x:.5}).to({x:1e-7},650).onUpdate(function(){e.editor.setAttribute("scale",this.x+" "+this.x+" "+this.x)}).easing(TWEEN.Easing.Exponential.Out).start()}openEditor(){this.cameraDummy.object3D.position.set(0,0,-.8),this.cameraDummy.object3D.updateMatrixWorld();let e=this;new TWEEN.Tween({x:1e-7}).to({x:.5},650).onUpdate(function(){e.editor.setAttribute("scale",this.x+" "+this.x+" "+this.x)}).easing(TWEEN.Easing.Exponential.Out).start(),new TWEEN.Tween(e.editor.getAttribute("position")).to(this.cameraDummy.object3D.localToWorld(new THREE.Vector3(0,0,0)),250).easing(TWEEN.Easing.Exponential.Out).start();let t=new THREE.Quaternion;this.cameraDummy.object3D.updateMatrixWorld(),this.cameraDummy.object3D.matrixWorld.decompose(new THREE.Vector3,t,new THREE.Vector3),new TWEEN.Tween(this.editor.object3D.quaternion).to(t,500).easing(TWEEN.Easing.Exponential.Out).start()}}})}]);